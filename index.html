<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ì±„ë„ ì¡°íšŒ ì›¹ì•±</title>
    <!-- 
      YouTube ì±„ë„ ì¡°íšŒ ì›¹ì•± v1.0
      =================================
      
      [ì‚¬ìš© ë°©ë²•]
      1. Google Cloud Console(https://console.cloud.google.com/)ì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±.
      2. "API ë° ì„œë¹„ìŠ¤" > "ë¼ì´ë¸ŒëŸ¬ë¦¬"ì—ì„œ "YouTube Data API v3"ë¥¼ ê²€ìƒ‰í•˜ì—¬ "ì‚¬ìš© ì„¤ì •".
      3. "API ë° ì„œë¹„ìŠ¤" > "ì‚¬ìš©ì ì¸ì¦ ì •ë³´"ì—ì„œ "API í‚¤" ìƒì„±.
      4. ìƒì„±ëœ API í‚¤ë¥¼ ë³µì‚¬í•˜ì—¬ ì•„ë˜ "API Key" ì…ë ¥ì¹¸ì— ë¶™ì—¬ë„£ê¸°.
      5. (ì„ íƒ) ë³´ì•ˆì„ ìœ„í•´, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  "í‚¤ ì €ì¥(ì•”í˜¸í™”)" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´
         API í‚¤ê°€ ë¸Œë¼ìš°ì €(localStorage)ì— ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.
      6. ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê³  ì—”í„° ë˜ëŠ” ê²€ìƒ‰ ë²„íŠ¼(ìš°ì¸¡ì— ì¶”ê°€í•œë‹¤ë©´)ì„ ëˆ„ë¥´ê±°ë‚˜,
         í•„í„°(ê¸°ê°„, ì •ë ¬, ê°œìˆ˜)ë¥¼ ë³€ê²½í•˜ë©´ ê²€ìƒ‰ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.

      [ì¤‘ìš”: file:// í”„ë¡œí† ì½œ ê²½ê³ ]
      ì´ HTML íŒŒì¼ì„ ë¡œì»¬ì—ì„œ 'file://' í”„ë¡œí† ì½œë¡œ ì§ì ‘ ì—´ë©´, 
      ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…(CORS, Referrer Policy)ìœ¼ë¡œ ì¸í•´ YouTube API ìš”ì²­ì´ 
      ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (API í‚¤ ìš”ì²­ ì‹œ 'Referer' í—¤ë”ê°€ ì „ì†¡ë˜ì§€ ì•ŠìŒ)

      [í•´ê²° ë°©ë²•]
      - (ê¶Œì¥) Live Server (VSCode í™•ì¥ í”„ë¡œê·¸ë¨)ì™€ ê°™ì€ ë¡œì»¬ ì›¹ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
      - ë˜ëŠ”, API í‚¤ ì„¤ì •ì—ì„œ HTTP ë¦¬í¼ëŸ¬ ì œí•œì„ "ì—†ìŒ"ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”. 
        (ë³´ì•ˆìƒ ê¶Œì¥ë˜ì§€ ì•ŠìŒ)

      [ìµœì†Œ ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤]
      1. ìœ íš¨í•œ API í‚¤ë¥¼ ì…ë ¥.
      2. ê²€ìƒ‰ì–´ "ì‹œë‹ˆì–´ ê±´ê°•", ê¸°ê°„ "3ê°œì›”", ì •ë ¬ "date", ê°œìˆ˜ "20" ì„ íƒ.
      3. ì˜ìƒ ëª©ë¡ì´ ì¹´ë“œ í˜•íƒœë¡œ ì •ìƒ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸.
      4. "ë³´ê¸°: í…Œì´ë¸”" ë²„íŠ¼ í´ë¦­ ì‹œ í…Œì´ë¸” ë·°ë¡œ ì „í™˜ë˜ëŠ”ì§€ í™•ì¸.
      5. "ë‹¤ìŒ" ë²„íŠ¼ í´ë¦­ ì‹œ ë‹¤ìŒ í˜ì´ì§€ ê²°ê³¼ê°€ ë¡œë“œë˜ëŠ”ì§€ í™•ì¸.
      6. "CSV" / "JSON" ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ì´ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸.
      7. "API í…ŒìŠ¤íŠ¸" ë²„íŠ¼ í´ë¦­ ì‹œ "API í‚¤ê°€ ìœ íš¨í•©ë‹ˆë‹¤." í† ìŠ¤íŠ¸ê°€ ëœ¨ëŠ”ì§€ í™•ì¸.
      8. API í‚¤ë¥¼ í‹€ë¦¬ê²Œ ì…ë ¥í•˜ê³  ê²€ìƒ‰ ì‹œ, ì—ëŸ¬ í† ìŠ¤íŠ¸ê°€ ëœ¨ëŠ”ì§€ í™•ì¸.
    -->
    <style>
        /* --- ë³€ìˆ˜ ë° ê¸°ë³¸ ì„¤ì • --- */
        :root {
            --color-red: #E53935;     /* ê²€ìƒ‰/ì‹¤í–‰/ì—ëŸ¬ */
            --color-blue: #1E88E5;    /* ë³´ì¡°/ì˜µì…˜/ì •ë³´ */
            --color-green: #43A047;   /* ë¦¬ì…‹/í† ê¸€/ì„±ê³µ/ë‚´ë³´ë‚´ê¸° */
            --color-text: #111;
            --color-bg: #ffffff;
            --color-border: #E5E7EB;
            --color-bg-alt: #f9fafb;
            --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë¦¬ì…‹ --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            padding-top: 180px; /* ìƒë‹¨ ê³ ì • ë°” ë†’ì´ë§Œí¼ íŒ¨ë”© (ìœ ë™ì ìœ¼ë¡œ ì¡°ì ˆë¨) */
        }

        /* --- ì ‘ê·¼ì„± --- */
        *:focus-visible {
            outline: 2px solid var(--color-blue);
            outline-offset: 2px;
            border-radius: var(--radius-md);
        }

        /* --- ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ --- */
        .hidden {
            display: none !important;
        }

        /* --- ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            background-color: var(--color-bg);
            color: var(--color-text);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            white-space: nowrap;
        }
        .btn:hover, .btn:focus-visible {
            border-color: #9ca3af;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn:active {
            transform: translateY(1px);
        }

        .btn-danger { background-color: var(--color-red); color: white; border-color: var(--color-red); }
        .btn-danger:hover { background-color: #d32f2f; border-color: #d32f2f; }
        
        .btn-primary { background-color: var(--color-blue); color: white; border-color: var(--color-blue); }
        .btn-primary:hover { background-color: #1976D2; border-color: #1976D2; }
        
        .btn-success { background-color: var(--color-green); color: white; border-color: var(--color-green); }
        .btn-success:hover { background-color: #388E3C; border-color: #388E3C; }

        /* --- ì…ë ¥ì¹¸ ìŠ¤íƒ€ì¼ --- */
        .input-field, .select-field {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            background-color: white;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .input-field:focus, .select-field:focus {
            border-color: var(--color-blue);
            box-shadow: 0 0 0 2px rgba(30, 136, 229, 0.2);
            outline: none;
        }

        /* --- ìƒë‹¨ ê²€ìƒ‰ ë°” --- */
        .search-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--color-bg);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem;
            box-shadow: var(--shadow-light);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .search-bar-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.75rem;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        #api-key-input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            flex-grow: 1;
            min-width: 150px;
        }
        #api-key-toggle {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            border-left: 0;
        }

        #search-query {
            flex-grow: 1;
            font-size: 1rem;
            min-width: 200px;
        }
        
        .crypto-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        #crypto-password {
            width: 120px;
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.75rem;
        }
        
        .chip-btn {
            font-size: 0.8rem;
            padding: 0.25rem 0.6rem;
        }
        .chip-btn.active {
            background-color: var(--color-blue);
            color: white;
            border-color: var(--color-blue);
        }

        /* --- ê²½ê³  ë°°ë„ˆ --- */
        .warning-banner {
            position: fixed;
            top: 0; /* JSë¡œ search-bar ë†’ì´ë§Œí¼ ë™ì  ì„¤ì •ë¨ */
            left: 0;
            right: 0;
            background-color: #fffbeb;
            border: 1px solid #fde68a;
            color: #b45309;
            padding: 0.75rem 1rem;
            z-index: 999;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }
        #close-banner-btn {
            background: none;
            border: none;
            color: #b45309;
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.25rem;
        }

        /* --- ë¡œë” --- */
        .loader {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            margin: 4rem auto;
            border: 6px solid #f3f3f3;
            border-top: 6px solid var(--color-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ --- */
        .content-area {
            padding: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* --- ê²°ê³¼ ì—†ìŒ ë©”ì‹œì§€ --- */
        #no-results-message {
            text-align: center;
            font-size: 1.1rem;
            color: #6b7280;
            padding: 3rem 1rem;
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-lg);
        }

        /* --- ì¹´ë“œ ë·° (Grid) --- */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .video-card {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: box-shadow 0.2s ease;
        }
        .video-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        .card-thumbnail {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 ë¹„ìœ¨ */
            background-color: var(--color-bg-alt);
        }
        .card-thumbnail img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .card-duration {
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            background-color: rgba(0, 0, 0, 0.75);
            color: white;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.15rem 0.4rem;
            border-radius: var(--radius-md);
        }

        .card-content {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text);
            text-decoration: none;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 0.5rem;
        }
        .card-title:hover {
            color: var(--color-blue);
        }

        .card-meta, .card-stats {
            font-size: 0.875rem;
            color: #4b5563;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        .card-meta span, .card-stats span {
            display: inline-flex;
            align-items: center;
        }

        .card-tags {
            margin-bottom: 0.75rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
        }
        .tag-chip {
            font-size: 0.75rem;
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            padding: 0.15rem 0.5rem;
            border-radius: 99px;
            white-space: nowrap;
        }

        .card-description {
            font-size: 0.875rem;
            color: #374151;
            margin-bottom: 0.5rem;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .description-toggle {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-blue);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem 0;
        }

        /* --- í…Œì´ë¸” ë·° (Table) --- */
        .results-table-wrapper {
            overflow-x: auto;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            min-width: 1200px; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ìƒì„± */
        }
        .results-table th, .results-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--color-border);
            text-align: left;
            vertical-align: top;
        }
        .results-table th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
        }
        .results-table tr:last-child td {
            border-bottom: 0;
        }
        .results-table tr:hover {
            background-color: #fcfcfc;
        }
        .table-thumbnail {
            width: 120px;
            height: 67.5px;
            object-fit: cover;
            border-radius: var(--radius-md);
        }
        .table-title {
            font-weight: 600;
            color: var(--color-text);
            text-decoration: none;
        }
        .table-title:hover {
            color: var(--color-blue);
        }
        .table-description {
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .table-tags {
            max-width: 250px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- í˜ì´ì§€ë„¤ì´ì…˜ --- */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        .pagination .btn {
            min-width: 100px;
        }

        /* --- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ --- */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .toast {
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            font-weight: 500;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
        }
        .toast.success {
            background-color: var(--color-green);
            color: white;
        }
        .toast.error {
            background-color: var(--color-red);
            color: white;
        }
        .toast.info {
            background-color: var(--color-blue);
            color: white;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; transform: translateX(100%); }
        }

        /* --- ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ --- */
        @media (max-width: 1024px) {
            body { padding-top: 220px; } /* ë°” ë†’ì´ ì¦ê°€ */
        }
        @media (max-width: 768px) {
            body { padding-top: 260px; } /* ë°” ë†’ì´ ì¦ê°€ */
            .content-area { padding: 1rem; }
            .results-grid {
                grid-template-columns: 1fr; /* ëª¨ë°”ì¼ì—ì„  1ì—´ */
                gap: 1rem;
            }
            .search-bar {
                padding: 0.75rem;
            }
            .search-bar-row {
                gap: 0.5rem;
            }
            .btn {
                padding: 0.5rem 0.6rem;
                font-size: 0.8rem;
            }
            .input-field, .select-field {
                font-size: 0.8rem;
                padding: 0.5rem 0.6rem;
            }
            .crypto-group {
                flex-wrap: wrap;
            }
            #crypto-password {
                width: 100px;
            }
        }
        @media (max-width: 480px) {
             body { padding-top: 360px; } /* ë°” ë†’ì´ ì¦ê°€ */
             .filter-group, .action-group {
                width: 100%;
                justify-content: space-between;
             }
             .select-field {
                 flex-grow: 1;
             }
        }

    </style>
</head>
<body>

    <!-- ìƒë‹¨ ê³ ì • ê²€ìƒ‰ ë°” -->
    <header class="search-bar" id="search-bar">
        <!-- 1í–‰: API í‚¤ ë° ê²€ìƒ‰ì–´ -->
        <div class="search-bar-row">
            <div class="input-group">
                <label for="api-key-input" class="hidden">API Key</label>
                <input type="password" id="api-key-input" class="input-field" placeholder="YouTube API Key ì…ë ¥">
                <button id="api-key-toggle" class="btn" aria-label="API í‚¤ í‘œì‹œ/ìˆ¨ê¹€">ğŸ‘ï¸</button>
            </div>
            
            <div class="crypto-group">
                <label for="crypto-password" class="hidden">ì•”í˜¸í™” ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="crypto-password" class="input-field" placeholder="í‚¤ ì•”í˜¸">
                <button id="save-key-btn" class="btn btn-primary" title="í˜„ì¬ API í‚¤ë¥¼ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¡œ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.">í‚¤ ì €ì¥</button>
                <button id="load-key-btn" class="btn btn-success" title="ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¡œ ì €ì¥ëœ API í‚¤ë¥¼ ë³µí˜¸í™”í•˜ì—¬ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.">í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>
        
        <div class="search-bar-row">
             <label for="search-query" class="hidden">ê²€ìƒ‰ì–´</label>
             <input type="search" id="search-query" class="input-field" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ í›„ Enter (ì˜ˆ: ì‹œë‹ˆì–´ ê±´ê°•)">
        </div>

        <!-- 2í–‰: í•„í„° -->
        <div class="search-bar-row filter-group">
            <div>
                <span style="font-size: 0.875rem; margin-right: 0.5rem;">ê¸°ê°„:</span>
                <button class="btn chip-btn" data-months="1">1ê°œì›”</button>
                <button class="btn chip-btn" data-months="2">2ê°œì›”</button>
                <button class="btn chip-btn" data-months="3">3ê°œì›”</button>
                <button class="btn chip-btn" data-months="6">6ê°œì›”</button>
                <button class="btn chip-btn" data-months="9">9ê°œì›”</button>
                <button class="btn chip-btn" data-months="12">12ê°œì›”</button>
            </div>
            <label for="sort-order" class="hidden">ì •ë ¬</label>
            <select id="sort-order" class="select-field">
                <option value="relevance">ê´€ë ¨ì„±</option>
                <option value="date">ìµœì‹ ìˆœ</option>
                <option value="viewCount">ì¡°íšŒìˆ˜ìˆœ</option>
                <option value="rating">í‰ì ìˆœ</option>
            </select>
            <label for="result-count" class="hidden">ê°œìˆ˜</label>
            <select id="result-count" class="select-field">
                <option value="10">10ê°œ</option>
                <option value="20">20ê°œ</option>
                <option value="30">30ê°œ</option>
                <option value="50">50ê°œ</option>
            </select>
        </div>

        <!-- 3í–‰: ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="search-bar-row action-group">
            <button id="view-toggle-btn" class="btn btn-success">ë³´ê¸°: í…Œì´ë¸”</button>
            <button id="reset-btn" class="btn btn-success">í•„í„° ë¦¬ì…‹</button>
            <button id="export-csv-btn" class="btn btn-success">Export CSV</button>
            <button id="copy-json-btn" class="btn btn-success">Copy JSON</button>
            <button id="api-test-btn" class="btn btn-danger">API í…ŒìŠ¤íŠ¸</button>
        </div>
    </header>

    <!-- ê²½ê³  ë°°ë„ˆ -->
    <div class="warning-banner" id="warning-banner">
        <span>âš ï¸ <strong>ì£¼ì˜:</strong> API í‚¤ê°€ ë¸Œë¼ìš°ì €ì— ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í˜ì´ì§€ë¥¼ ê³µê°œì ìœ¼ë¡œ ê³µìœ í•˜ì§€ ë§ˆì„¸ìš”.<br>
              ë¡œì»¬ì—ì„œ `file://`ë¡œ ì‹¤í–‰ ì‹œ API ìš”ì²­ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë¡œì»¬ ì„œë²„ ê¶Œì¥).</span>
        <button id="close-banner-btn" aria-label="ë°°ë„ˆ ë‹«ê¸°">&times;</button>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="content-area">
        <!-- ë¡œë” -->
        <div class="loader" id="loader"></div>
        
        <!-- ê²°ê³¼ ì»¨í…Œì´ë„ˆ -->
        <div id="results-container">
            <!-- ë™ì  ì»¨í…ì¸  (ì¹´ë“œ ë˜ëŠ” í…Œì´ë¸”) -->
        </div>

        <!-- ê²°ê³¼ ì—†ìŒ ë©”ì‹œì§€ -->
        <div id="no-results-message" class="hidden">
            <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ê²€ìƒ‰ì–´ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ê¸°ê°„ í•„í„°ë¥¼ í™•ì¥í•´ ë³´ì„¸ìš”.</p>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <nav class="pagination" id="pagination-controls">
            <button id="prev-page-btn" class="btn" disabled>&larr; ì´ì „</button>
            <button id="next-page-btn" class="btn" disabled>ë‹¤ìŒ &rarr;</button>
        </nav>
    </main>

    <!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div class="toast-container" id="toast-container"></div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM ìš”ì†Œ ---
            const dom = {
                searchBar: document.getElementById('search-bar'),
                apiKeyInput: document.getElementById('api-key-input'),
                apiKeyToggle: document.getElementById('api-key-toggle'),
                cryptoPasswordInput: document.getElementById('crypto-password'),
                saveKeyBtn: document.getElementById('save-key-btn'),
                loadKeyBtn: document.getElementById('load-key-btn'),
                searchQueryInput: document.getElementById('search-query'),
                periodChipContainer: document.querySelector('.filter-group div'),
                sortOrderSelect: document.getElementById('sort-order'),
                resultCountSelect: document.getElementById('result-count'),
                viewToggleBtn: document.getElementById('view-toggle-btn'),
                resetBtn: document.getElementById('reset-btn'),
                exportCsvBtn: document.getElementById('export-csv-btn'),
                copyJsonBtn: document.getElementById('copy-json-btn'),
                apiTestBtn: document.getElementById('api-test-btn'),
                warningBanner: document.getElementById('warning-banner'),
                closeBannerBtn: document.getElementById('close-banner-btn'),
                loader: document.getElementById('loader'),
                resultsContainer: document.getElementById('results-container'),
                noResultsMessage: document.getElementById('no-results-message'),
                paginationControls: document.getElementById('pagination-controls'),
                prevPageBtn: document.getElementById('prev-page-btn'),
                nextPageBtn: document.getElementById('next-page-btn'),
                toastContainer: document.getElementById('toast-container'),
            };

            // --- ìƒíƒœ ë³€ìˆ˜ ---
            const YOUTUBE_API_BASE = 'https://www.googleapis.com/youtube/v3';
            let apiKey = '';
            let currentView = 'grid'; // 'grid' or 'table'
            let currentResults = []; // í˜„ì¬ ë¡œë“œëœ ë¹„ë””ì˜¤ ë°ì´í„°
            let pageTokens = { next: null, prev: [] }; // í˜ì´ì§€ë„¤ì´ì…˜ í† í° ìŠ¤íƒ
            let searchCache = new Map(); // ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ìºì‹œ
            let searchTimeout;

            // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

            /**
             * í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
             * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
             * @param {'success' | 'error' | 'info'} type - í† ìŠ¤íŠ¸ íƒ€ì…
             */
            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                dom.toastContainer.appendChild(toast);
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }

            /**
             * ë¡œë” í‘œì‹œ/ìˆ¨ê¹€
             * @param {boolean} show - í‘œì‹œ ì—¬ë¶€
             */
            function showLoader(show) {
                dom.loader.style.display = show ? 'block' : 'none';
            }

            /**
             * "ê²°ê³¼ ì—†ìŒ" ë©”ì‹œì§€ í‘œì‹œ/ìˆ¨ê¹€
             * @param {boolean} show - í‘œì‹œ ì—¬ë¶€
             */
            function showNoResults(show) {
                dom.noResultsMessage.classList.toggle('hidden', !show);
            }

            /**
             * ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜
             * @param {Function} func - ì‹¤í–‰í•  í•¨ìˆ˜
             * @param {number} delay - ì§€ì—° ì‹œê°„ (ms)
             */
            function debounce(func, delay) {
                return function(...args) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => func.apply(this, args), delay);
                };
            }

            /**
             * ISO 8601 ê¸°ê°„(PT#H#M#S) íŒŒì‹±
             * @param {string} durationString - ì˜ˆ: "PT1H30M15S"
             * @returns {string} - "h:mm:ss" ë˜ëŠ” "mm:ss"
             */
            function formatDuration(durationString) {
                if (!durationString) return '00:00';
                const match = durationString.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
                if (!match) return '00:00';

                const hours = parseInt(match[1] || 0, 10);
                const minutes = parseInt(match[2] || 0, 10);
                const seconds = parseInt(match[3] || 0, 10);

                const totalSeconds = hours * 3600 + minutes * 60 + seconds;
                const h = Math.floor(totalSeconds / 3600);
                const m = Math.floor((totalSeconds % 3600) / 60);
                const s = totalSeconds % 60;

                const pad = (num) => String(num).padStart(2, '0');
                
                if (h > 0) {
                    return `${h}:${pad(m)}:${pad(s)}`;
                } else {
                    return `${pad(m)}:${pad(s)}`;
                }
            }

            /**
             * ë‚ ì§œ í¬ë§· (Asia/Seoul)
             * @param {string} isoString - UTC ISO ë‚ ì§œ ë¬¸ìì—´
             * @returns {string} - "YYYY. MM. DD. ì˜¤ì „/ì˜¤í›„ h:mm"
             */
            function formatDate(isoString) {
                try {
                    return new Date(isoString).toLocaleString('ko-KR', {
                        timeZone: 'Asia/Seoul',
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: true
                    });
                } catch (e) {
                    return 'N/A';
                }
            }

            /**
             * ìˆ«ì ì½¤ë§ˆ í¬ë§·
             * @param {string|number} num - ìˆ«ì
             * @returns {string} - "1,234,567"
             */
            function formatNumber(num) {
                try {
                    return parseInt(num, 10).toLocaleString('ko-KR');
                } catch (e) {
                    return '0';
                }
            }

            /**
             * Nê°œì›” ì „ ë‚ ì§œ ê³„ì‚° (UTC ISO ë¬¸ìì—´ ë°˜í™˜)
             * @param {number | null} months - ê°œì›” ìˆ˜
             * @returns {string | null} - UTC ISO ë¬¸ìì—´
             */
            function calculatePublishedAfter(months) {
                if (months === null) return null;
                const date = new Date();
                date.setMonth(date.getMonth() - months);
                date.setHours(0, 0, 0, 0); // í˜„ì§€ ì‹œê°„ ê¸°ì¤€ 00:00:00
                return date.toISOString(); // UTCë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
            }

            /**
             * HTML íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
             * @param {string} str 
             */
            function escapeHTML(str) {
                if (!str) return '';
                return str.replace(/[&<>"']/g, function(m) {
                    return {
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#39;'
                    }[m];
                });
            }

            /**
             * CSV ë‚´ìš© ì´ìŠ¤ì¼€ì´í”„
             * @param {string} str 
             */
            function escapeCSV(str) {
                if (str === null || str === undefined) return '';
                str = String(str);
                // í•„ë“œì— ì½¤ë§ˆ, ë”°ì˜´í‘œ, ì¤„ë°”ê¿ˆì´ í¬í•¨ë˜ë©´ ë”°ì˜´í‘œë¡œ ê°ìŒˆ
                if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                    // ë”°ì˜´í‘œëŠ” ë‘ ê°œë¡œ ì¹˜í™˜
                    return `"${str.replace(/"/g, '""')}"`;
                }
                return str;
            }


            // --- localStorage ì„¤ì • ì €ì¥/ë¡œë“œ ---

            function saveSettings() {
                const periodBtn = dom.periodChipContainer.querySelector('.active');
                const settings = {
                    query: dom.searchQueryInput.value,
                    period: periodBtn ? periodBtn.dataset.months : null,
                    sort: dom.sortOrderSelect.value,
                    count: dom.resultCountSelect.value,
                    view: currentView
                };
                localStorage.setItem('youtubeSearchSettings', JSON.stringify(settings));
            }

            function loadSettings() {
                const settings = JSON.parse(localStorage.getItem('youtubeSearchSettings') || '{}');
                
                dom.searchQueryInput.value = settings.query || '';
                dom.sortOrderSelect.value = settings.sort || 'relevance';
                dom.resultCountSelect.value = settings.count || '10';
                
                if (settings.period) {
                    const periodBtn = dom.periodChipContainer.querySelector(`[data-months="${settings.period}"]`);
                    if (periodBtn) periodBtn.classList.add('active');
                }
                
                if (settings.view === 'table') {
                    toggleView(true); // ë·° ì „í™˜
                }

                // API í‚¤ëŠ” ì•”í˜¸í™”ëœ ì €ì¥ì†Œì—ì„œ ë³„ë„ ë¡œë“œ ì‹œë„
                if (localStorage.getItem('youtubeApiKey_iv')) {
                    showToast('ì €ì¥ëœ ì•”í˜¸í™” í‚¤ê°€ ìˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¡œ "í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°"ë¥¼ í•˜ì„¸ìš”.', 'info');
                }
            }

            /**
             * í•„í„° ë¦¬ì…‹
             */
            function resetSettings() {
                localStorage.removeItem('youtubeSearchSettings');
                dom.searchQueryInput.value = '';
                dom.sortOrderSelect.value = 'relevance';
                dom.resultCountSelect.value = '10';
                dom.periodChipContainer.querySelectorAll('.active').forEach(b => b.classList.remove('active'));
                
                // ê²€ìƒ‰ ì´ˆê¸°í™”
                currentResults = [];
                pageTokens = { next: null, prev: [] };
                searchCache.clear();
                renderResults([]);
                updatePagination(null);
                
                showToast('í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }


            // --- API í‚¤ ì•”í˜¸í™” (WebCrypto) ---
            /*
             * ì°¸ê³ : ì´ ì•”í˜¸í™”ëŠ” localStorageì— ì €ì¥ëœ í‚¤ë¥¼ "at-rest" ìƒíƒœì—ì„œ ë³´í˜¸í•˜ê¸° 
             * ìœ„í•¨ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ë§Œ í‚¤ê°€ ë©”ëª¨ë¦¬ë¡œ ë³µí˜¸í™”ë©ë‹ˆë‹¤.
             *
             * í•˜ì§€ë§Œ ì´ëŠ” ë„¤íŠ¸ì›Œí¬ ì „ì†¡ ì‹œ í‚¤ ë…¸ì¶œì´ë‚˜, ë©”ëª¨ë¦¬ì— ë¡œë“œëœ í›„ì˜ 
             * í‚¤ ë…¸ì¶œì„ ë°©ì§€í•˜ì§€ëŠ” ëª»í•©ë‹ˆë‹¤. (ê·¼ë³¸ì ì¸ ë¸Œë¼ìš°ì € API í‚¤ ì‚¬ìš©ì˜ í•œê³„)
             */
            
            // í—¬í¼: Text <-> ArrayBuffer
            const enc = new TextEncoder();
            const dec = new TextDecoder();
            
            // í—¬í¼: ArrayBuffer -> Base64
            function ab2b64(buffer) {
                let binary = '';
                const bytes = new Uint8Array(buffer);
                const len = bytes.byteLength;
                for (let i = 0; i < len; i++) {
                    binary += String.fromCharCode(bytes[i]);
                }
                return window.btoa(binary);
            }
            
            // í—¬í¼: Base64 -> ArrayBuffer
            function b642ab(base64) {
                const binary_string = window.atob(base64);
                const len = binary_string.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binary_string.charCodeAt(i);
                }
                return bytes.buffer;
            }

            /**
             * PBKDF2ë¡œë¶€í„° ì•”í˜¸í™” í‚¤ ë„ì¶œ
             */
            async function getKey(password, salt) {
                const keyMaterial = await crypto.subtle.importKey(
                    "raw",
                    enc.encode(password),
                    "PBKDF2",
                    false,
                    ["deriveKey"]
                );
                return crypto.subtle.deriveKey(
                    {
                        name: "PBKDF2",
                        salt: salt,
                        iterations: 150000, // ìµœì†Œ 10ë§Œ ê¶Œì¥
                        hash: "SHA-256"
                    },
                    keyMaterial,
                    { name: "AES-GCM", length: 256 },
                    true,
                    ["encrypt", "decrypt"]
                );
            }

            /**
             * API í‚¤ ì•”í˜¸í™” ë° ì €ì¥
             */
            async function encryptAndStoreKey() {
                const password = dom.cryptoPasswordInput.value;
                const keyToStore = dom.apiKeyInput.value;

                if (!password || !keyToStore) {
                    showToast('API í‚¤ì™€ ì•”í˜¸í™” ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                    return;
                }

                try {
                    const salt = crypto.getRandomValues(new Uint8Array(16));
                    const iv = crypto.getRandomValues(new Uint8Array(12)); // AES-GCM ê¶Œì¥ IV
                    const key = await getKey(password, salt);
                    
                    const encryptedData = await crypto.subtle.encrypt(
                        { name: "AES-GCM", iv: iv },
                        key,
                        enc.encode(keyToStore)
                    );

                    // {salt, iv, data} Base64ë¡œ ì €ì¥
                    localStorage.setItem('youtubeApiKey_salt', ab2b64(salt));
                    localStorage.setItem('youtubeApiKey_iv', ab2b64(iv));
                    localStorage.setItem('youtubeApiKey_data', ab2b64(encryptedData));

                    dom.cryptoPasswordInput.value = ''; // ë¹„ë°€ë²ˆí˜¸ í•„ë“œ ë¹„ìš°ê¸°
                    showToast('API í‚¤ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í–ˆìŠµë‹ˆë‹¤.', 'success');

                } catch (e) {
                    console.error("í‚¤ ì €ì¥ ì‹¤íŒ¨:", e);
                    showToast(`í‚¤ ì €ì¥ ì‹¤íŒ¨: ${e.message}`, 'error');
                }
            }

            /**
             * API í‚¤ ë³µí˜¸í™” ë° ë¡œë“œ
             */
            async function loadAndDecryptKey() {
                const password = dom.cryptoPasswordInput.value;
                if (!password) {
                    showToast('ì•”í˜¸í™” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                    return;
                }

                const salt_b64 = localStorage.getItem('youtubeApiKey_salt');
                const iv_b64 = localStorage.getItem('youtubeApiKey_iv');
                const data_b64 = localStorage.getItem('youtubeApiKey_data');

                if (!salt_b64 || !iv_b64 || !data_b64) {
                    showToast('ì €ì¥ëœ ì•”í˜¸í™” í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                try {
                    const salt = b642ab(salt_b64);
                    const iv = b642ab(iv_b64);
                    const encryptedData = b642ab(data_b64);

                    const key = await getKey(password, salt);
                    
                    const decryptedData = await crypto.subtle.decrypt(
                        { name: "AES-GCM", iv: iv },
                        key,
                        encryptedData
                    );

                    const decryptedKey = dec.decode(decryptedData);
                    dom.apiKeyInput.value = decryptedKey;
                    apiKey = decryptedKey; // ì „ì—­ ë³€ìˆ˜ì—ë„ ì„¤ì •
                    dom.cryptoPasswordInput.value = ''; // ë¹„ë°€ë²ˆí˜¸ í•„ë“œ ë¹„ìš°ê¸°
                    showToast('API í‚¤ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');

                } catch (e) {
                    console.error("í‚¤ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", e);
                    // ë³µí˜¸í™” ì‹¤íŒ¨ëŠ” ëŒ€ë¶€ë¶„ ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜
                    showToast('í‚¤ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ê±°ë‚˜ ë°ì´í„°ê°€ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }


            // --- API í˜¸ì¶œ ë¡œì§ ---

            /**
             * API ì—ëŸ¬ í•¸ë“¤ëŸ¬
             * @param {Error} error 
             */
            function handleApiError(error, response = null) {
                console.error("API Error:", error, response);
                showLoader(false);
                
                let message = `API ìš”ì²­ ì‹¤íŒ¨: ${error.message}`;

                if (window.location.protocol === 'file:') {
                    message += '\n[file://] í”„ë¡œí† ì½œ ê°ì§€. ë¡œì»¬ ì„œë²„ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.';
                }

                if (response && response.error) {
                    const apiError = response.error;
                    message = `[${apiError.code}] ${apiError.message}\n`;
                    const reason = apiError.errors?.[0]?.reason;
                    if (reason === 'keyInvalid') {
                        message += 'API í‚¤ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
                    } else if (reason === 'quotaExceeded') {
                        message += 'API í• ë‹¹ëŸ‰(ì¿¼í„°)ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.';
                    } else if (reason === 'forbidden') {
                        message += 'API ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤ (IP/ë¦¬í¼ëŸ¬ ì œí•œ ë“±).';
                    }
                }

                showToast(message.replace(/\n/g, ' '), 'error');
            }

            /**
             * ë©”ì¸ ê²€ìƒ‰ í•¨ìˆ˜
             * @param {string | null} pageToken - í˜ì´ì§€ í† í° (ë‹¤ìŒ/ì´ì „)
             */
            async function handleSearch(pageToken = null) {
                apiKey = dom.apiKeyInput.value;
                if (!apiKey) {
                    showToast('YouTube API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                    return;
                }

                // pageTokenì´ nullì´ ì•„ë‹ˆë©´(í˜ì´ì§€ ì´ë™), ìƒˆ ê²€ìƒ‰ì´ ì•„ë‹˜
                if (pageToken === null) {
                    pageTokens = { next: null, prev: [] }; // ìƒˆ ê²€ìƒ‰ ì‹œ í† í° ë¦¬ì…‹
                }

                const query = dom.searchQueryInput.value.trim();
                const sortOrder = dom.sortOrderSelect.value;
                const maxResults = dom.resultCountSelect.value;
                const periodBtn = dom.periodChipContainer.querySelector('.active');
                const periodMonths = periodBtn ? parseInt(periodBtn.dataset.months, 10) : null;
                const publishedAfter = calculatePublishedAfter(periodMonths);

                if (!query) {
                    showToast('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'info');
                    return;
                }

                // 1. search.list API (ì˜ìƒ ID ëª©ë¡ ê°€ì ¸ì˜¤ê¸°)
                const searchParams = new URLSearchParams({
                    part: 'snippet',
                    type: 'video',
                    q: query,
                    order: sortOrder,
                    maxResults: maxResults,
                    key: apiKey,
                });

                if (publishedAfter) {
                    searchParams.set('publishedAfter', publishedAfter);
                }
                if (pageToken) {
                    searchParams.set('pageToken', pageToken);
                }
                
                const searchUrl = `${YOUTUBE_API_BASE}/search?${searchParams.toString()}`;

                // ìºì‹œ í™•ì¸ (í˜ì´ì§€ ì´ë™ ì‹œì—ëŠ” ìºì‹œ ì‚¬ìš© ì•ˆ í•¨)
                if (!pageToken && searchCache.has(searchUrl)) {
                    const cachedData = searchCache.get(searchUrl);
                    console.log("Using cached search data...");
                    processVideoIds(cachedData, pageToken);
                    return;
                }

                showLoader(true);
                showNoResults(false);
                dom.resultsContainer.innerHTML = ''; // ì´ì „ ê²°ê³¼ ë¹„ìš°ê¸°

                try {
                    const response = await fetch(searchUrl);
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error?.message || response.statusText);
                    }
                    
                    if (!pageToken) {
                        searchCache.set(searchUrl, data); // ìƒˆ ê²€ìƒ‰ ìºì‹œ
                    }
                    
                    await processVideoIds(data, pageToken);

                } catch (error) {
                    // response.json()ì´ ì‹¤íŒ¨í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ data ê°ì²´ê°€ ì—†ì„ ìˆ˜ ìˆìŒ
                    handleApiError(error, error.response?.data);
                } finally {
                    showLoader(false);
                    saveSettings(); // ê²€ìƒ‰ ì„±ê³µ ì‹œ ì„¤ì • ì €ì¥
                }
            }

            /**
             * 1ë‹¨ê³„(search) ì™„ë£Œ í›„ 2ë‹¨ê³„(videos) í˜¸ì¶œ
             */
            async function processVideoIds(searchData, originalPageToken) {
                const videoItems = searchData.items;

                if (!videoItems || videoItems.length === 0) {
                    showNoResults(true);
                    updatePagination(null); // ê²°ê³¼ ì—†ìœ¼ë©´ í˜ì´ì§€ë„¤ì´ì…˜ë„ ì—†ìŒ
                    return;
                }

                const videoIds = videoItems.map(item => item.id.videoId).join(',');
                
                // í˜ì´ì§€ë„¤ì´ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸
                // 'ì´ì „' ë²„íŠ¼ í´ë¦­ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ prev ìŠ¤íƒì— ì¶”ê°€
                if (originalPageToken !== pageTokens.prev[pageTokens.prev.length - 1]) {
                    pageTokens.prev.push(searchData.prevPageToken);
                }
                pageTokens.next = searchData.nextPageToken || null;
                
                updatePagination(searchData);

                // 2. videos.list API (ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°)
                const videosParams = new URLSearchParams({
                    part: 'snippet,contentDetails,statistics',
                    id: videoIds,
                    key: apiKey,
                });
                const videosUrl = `${YOUTUBE_API_BASE}/videos?${videosParams.toString()}`;

                const vidResponse = await fetch(videosUrl);
                const vidData = await vidResponse.json();

                if (!vidResponse.ok) {
                    throw new Error(vidData.error?.message || vidResponse.statusText);
                }

                currentResults = vidData.items || [];
                renderResults(currentResults);
            }


            // --- ë Œë”ë§ ë¡œì§ ---

            /**
             * ê²°ê³¼ ë Œë”ë§ (ë·°ì— ë”°ë¼ ë¶„ê¸°)
             */
            function renderResults(results) {
                showNoResults(results.length === 0 && !dom.loader.style.display);
                dom.resultsContainer.innerHTML = ''; // ì´ˆê¸°í™”
                
                if (currentView === 'grid') {
                    renderGridView(results);
                } else {
                    renderTableView(results);
                }
            }

            /**
             * ì¹´ë“œ ë·° ë Œë”ë§
             */
            function renderGridView(results) {
                const grid = document.createElement('div');
                grid.className = 'results-grid';
                
                grid.innerHTML = results.map(item => {
                    const snippet = item.snippet || {};
                    const stats = item.statistics || {};
                    const details = item.contentDetails || {};

                    const videoId = item.id;
                    const title = escapeHTML(snippet.title);
                    const url = `https://www.youtube.com/watch?v=${videoId}`;
                    const thumbUrl = snippet.thumbnails?.high?.url || snippet.thumbnails?.medium?.url || 'https://placehold.co/480x270/e0e0e0/757575?text=No+Thumbnail';
                    const duration = formatDuration(details.duration);
                    
                    const channelTitle = escapeHTML(snippet.channelTitle);
                    const publishedAt = formatDate(snippet.publishedAt);
                    const viewCount = formatNumber(stats.viewCount);
                    
                    const description = escapeHTML(snippet.description);
                    const isLongDescription = description.length > 160;
                    const shortDesc = isLongDescription ? description.substring(0, 160) + '...' : description;
                    
                    const tags = snippet.tags || [];
                    const maxTags = 10;
                    const tagChips = tags.slice(0, maxTags).map(tag => 
                        `<span class="tag-chip">${escapeHTML(tag)}</span>`
                    ).join('');
                    const moreTags = tags.length > maxTags ? `<span class="tag-chip">+${tags.length - maxTags}</span>` : '';

                    return `
                        <div class="video-card" data-video-id="${videoId}">
                            <div class="card-thumbnail">
                                <a href="${url}" target="_blank" rel="noopener noreferrer">
                                    <img src="${thumbUrl}" alt="${title} ì¸ë„¤ì¼" loading="lazy">
                                </a>
                                <span class="card-duration">${duration}</span>
                            </div>
                            <div class="card-content">
                                <a href="${url}" target="_blank" rel="noopener noreferrer" class="card-title" title="${title}">${title}</a>
                                <div class="card-meta">
                                    <span title="${channelTitle}">ğŸ“º ${channelTitle}</span>
                                    <span>ğŸ—“ï¸ ${publishedAt}</span>
                                </div>
                                <div class="card-stats">
                                    <span>ğŸ‘€ ì¡°íšŒìˆ˜ ${viewCount}íšŒ</span>
                                </div>
                                <div class="card-tags">
                                    ${tagChips}
                                    ${moreTags}
                                </div>
                                <div class="card-description" data-short="${shortDesc}" data-full="${description}">
                                    ${shortDesc.replace(/\n/g, '<br>')}
                                </div>
                                ${isLongDescription ? `
                                    <button class="description-toggle" aria-expanded="false" aria-controls="desc-${videoId}">
                                        ë”ë³´ê¸°
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                dom.resultsContainer.appendChild(grid);
            }

            /**
             * í…Œì´ë¸” ë·° ë Œë”ë§
             */
            function renderTableView(results) {
                const wrapper = document.createElement('div');
                wrapper.className = 'results-table-wrapper';
                
                const tableHeader = `
                    <thead>
                        <tr>
                            <th>ì¸ë„¤ì¼</th>
                            <th>ì œëª©</th>
                            <th>ì±„ë„ëª…</th>
                            <th>ê²Œì‹œì¼</th>
                            <th>ê¸¸ì´</th>
                            <th>ì¡°íšŒìˆ˜</th>
                            <th>ì¢‹ì•„ìš”</th>
                            <th>íƒœê·¸</th>
                            <th>ì„¤ëª…</th>
                        </tr>
                    </thead>
                `;
                
                const tableBody = results.map(item => {
                    const snippet = item.snippet || {};
                    const stats = item.statistics || {};
                    const details = item.contentDetails || {};

                    const videoId = item.id;
                    const title = escapeHTML(snippet.title);
                    const url = `https://www.youtube.com/watch?v=${videoId}`;
                    const thumbUrl = snippet.thumbnails?.default?.url || 'https://placehold.co/120x90/e0e0e0/757575?text=Thumb';
                    
                    return `
                        <tr>
                            <td>
                                <a href="${url}" target="_blank" rel="noopener noreferrer">
                                    <img src="${thumbUrl}" alt="${title} ì¸ë„¤ì¼" class="table-thumbnail" loading="lazy">
                                </a>
                            </td>
                            <td><a href="${url}" target="_blank" rel="noopener noreferrer" class="table-title" title="${title}">${title}</a></td>
                            <td>${escapeHTML(snippet.channelTitle)}</td>
                            <td>${formatDate(snippet.publishedAt)}</td>
                            <td>${formatDuration(details.duration)}</td>
                            <td>${formatNumber(stats.viewCount)}</td>
                            <td>${formatNumber(stats.likeCount)}</td>
                            <td class="table-tags" title="${escapeHTML((snippet.tags || []).join(', '))}">${escapeHTML((snippet.tags || []).join(', '))}</td>
                            <td class="table-description" title="${escapeHTML(snippet.description)}">${escapeHTML(snippet.description)}</td>
                        </tr>
                    `;
                }).join('');

                wrapper.innerHTML = `
                    <table class="results-table">
                        ${tableHeader}
                        <tbody>${tableBody}</tbody>
                    </table>
                `;
                dom.resultsContainer.appendChild(wrapper);
            }

            /**
             * í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸
             */
            function updatePagination(searchData) {
                dom.prevPageBtn.disabled = pageTokens.prev.length <= 1; // 0ë²ˆ ì¸ë±ìŠ¤ëŠ” undefinedì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ 1 ê¸°ì¤€
                dom.nextPageBtn.disabled = !pageTokens.next;
                dom.paginationControls.classList.toggle('hidden', !searchData && currentResults.length === 0);
            }
            
            /**
             * ë·° ëª¨ë“œ ì „í™˜
             * @param {boolean} [forceTable] - í…Œì´ë¸” ë·°ë¡œ ê°•ì œ
             */
            function toggleView(forceTable = false) {
                const isGrid = currentView === 'grid';
                if (forceTable) {
                    currentView = 'table';
                } else {
                    currentView = isGrid ? 'table' : 'grid';
                }

                if (currentView === 'table') {
                    dom.viewToggleBtn.textContent = 'ë³´ê¸°: ì¹´ë“œ';
                    dom.viewToggleBtn.classList.remove('btn-success');
                    dom.viewToggleBtn.classList.add('btn-primary');
                    document.body.classList.add('view-table'); // (CSSì—ì„œ í˜„ì¬ ì‚¬ìš© ì•ˆ í•¨)
                } else {
                    dom.viewToggleBtn.textContent = 'ë³´ê¸°: í…Œì´ë¸”';
                    dom.viewToggleBtn.classList.remove('btn-primary');
                    dom.viewToggleBtn.classList.add('btn-success');
                    document.body.classList.remove('view-table');
                }
                
                // í˜„ì¬ ë°ì´í„°ë¡œ ë·° ë‹¤ì‹œ ë Œë”ë§
                renderResults(currentResults);
                saveSettings(); // ë·° ìƒíƒœ ì €ì¥
            }


            // --- ë‚´ë³´ë‚´ê¸° ë¡œì§ ---

            function exportCSV() {
                if (currentResults.length === 0) {
                    showToast('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                const headers = [
                    'videoId', 'title', 'description', 'tags', 'channelTitle', 
                    'publishedAt', 'duration', 'viewCount', 'likeCount', 'url', 'thumbnailUrl'
                ];
                
                const csvRows = [headers.join(',')];

                currentResults.forEach(item => {
                    const snippet = item.snippet || {};
                    const stats = item.statistics || {};
                    const details = item.contentDetails || {};

                    const row = [
                        item.id,
                        snippet.title,
                        snippet.description,
                        (snippet.tags || []).join('|'), // íƒœê·¸ëŠ” |ë¡œ ê²°í•©
                        snippet.channelTitle,
                        snippet.publishedAt,
                        details.duration,
                        stats.viewCount,
                        stats.likeCount,
                        `https://www.youtube.com/watch?v=${item.id}`,
                        snippet.thumbnails?.high?.url
                    ];
                    
                    csvRows.push(row.map(escapeCSV).join(','));
                });

                const csvString = csvRows.join('\n');
                // UTF-8 BOM ì¶”ê°€ (Excel í˜¸í™˜)
                const blob = new Blob(['\uFEFF' + csvString], { type: 'text/csv;charset=utf-8;' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `Youtube_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                showToast('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.', 'success');
            }

            function copyJSON() {
                if (currentResults.length === 0) {
                    showToast('ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                const jsonString = JSON.stringify(currentResults, null, 2);
                
                // navigator.clipboard (ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ì—ì„œë§Œ ì‘ë™, file:// ì•ˆë¨)
                if (navigator.clipboard && window.isSecureContext) {
                     navigator.clipboard.writeText(jsonString).then(() => {
                        showToast('JSONì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    }, () => {
                        showToast('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    });
                } else {
                    // êµ¬í˜• fallback (iframe ì œí•œ ì‹œ ë™ì‘ ì•ˆ í•  ìˆ˜ ìˆìŒ)
                    try {
                        const textArea = document.createElement('textarea');
                        textArea.value = jsonString;
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showToast('JSONì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    } catch (e) {
                         showToast('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ë³´ì•ˆ ì œí•œ)', 'error');
                    }
                }
            }


            // --- API í…ŒìŠ¤íŠ¸ ---
            
            async function testApiKey() {
                apiKey = dom.apiKeyInput.value;
                if (!apiKey) {
                    showToast('í…ŒìŠ¤íŠ¸í•  API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                    return;
                }
                
                // i18nLanguages.list (ê°€ë²¼ìš´ ì¿¼í„° ì†Œëª¨ 1)
                const testUrl = `${YOUTUBE_API_BASE}/i18nLanguages?part=snippet&key=${apiKey}`;
                
                showToast('API í‚¤ í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');

                try {
                    const response = await fetch(testUrl);
                    const data = await response.json();
                    
                    if (response.ok) {
                        showToast('API í‚¤ê°€ ìœ íš¨í•©ë‹ˆë‹¤.', 'success');
                    } else {
                        handleApiError(new Error(data.error?.message), data);
                    }
                } catch (e) {
                    handleApiError(e);
                }
            }


            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë°”ì¸ë”© ---

            // ê²€ìƒ‰ì–´ ì…ë ¥ (ë””ë°”ìš´ìŠ¤)
            const debouncedSearch = debounce(() => handleSearch(null), 300);
            dom.searchQueryInput.addEventListener('input', debouncedSearch);
            dom.searchQueryInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    clearTimeout(searchTimeout); // ë””ë°”ìš´ìŠ¤ ì·¨ì†Œ
                    handleSearch(null); // ì¦‰ì‹œ ì‹¤í–‰
                }
            });

            // í•„í„° ë³€ê²½ ì‹œ ìë™ ê²€ìƒ‰
            dom.sortOrderSelect.addEventListener('change', () => handleSearch(null));
            dom.resultCountSelect.addEventListener('change', () => handleSearch(null));

            // ê¸°ê°„ ì¹© ì„ íƒ
            dom.periodChipContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('chip-btn')) {
                    // ê¸°ì¡´ active ì œê±°
                    dom.periodChipContainer.querySelector('.active')?.classList.remove('active');
                    // í´ë¦­í•œ ì¹© active
                    e.target.classList.add('active');
                    handleSearch(null); // ê²€ìƒ‰ ì‹¤í–‰
                }
            });

            // API í‚¤ í† ê¸€
            dom.apiKeyToggle.addEventListener('click', () => {
                const isPassword = dom.apiKeyInput.type === 'password';
                dom.apiKeyInput.type = isPassword ? 'text' : 'password';
                dom.apiKeyToggle.textContent = isPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸';
            });
            
            // API í‚¤ ì•”í˜¸í™”
            dom.saveKeyBtn.addEventListener('click', encryptAndStoreKey);
            dom.loadKeyBtn.addEventListener('click', loadAndDecryptKey);

            // ë·° í† ê¸€
            dom.viewToggleBtn.addEventListener('click', () => toggleView());
            
            // ë¦¬ì…‹
            dom.resetBtn.addEventListener('click', resetSettings);
            
            // ë‚´ë³´ë‚´ê¸°
            dom.exportCsvBtn.addEventListener('click', exportCSV);
            dom.copyJsonBtn.addEventListener('click', copyJSON);
            
            // API í…ŒìŠ¤íŠ¸
            dom.apiTestBtn.addEventListener('click', testApiKey);

            // ê²½ê³  ë°°ë„ˆ ë‹«ê¸°
            dom.closeBannerBtn.addEventListener('click', () => {
                dom.warningBanner.style.display = 'none';
                // ë°°ë„ˆê°€ ë‹«íˆë©´ body ìƒë‹¨ íŒ¨ë”© ì¡°ì ˆ
                updateBodyPadding();
            });

            // í˜ì´ì§€ë„¤ì´ì…˜
            dom.prevPageBtn.addEventListener('click', () => {
                // í˜„ì¬ í† í°ì„ ìŠ¤íƒì—ì„œ ì œê±°
                pageTokens.prev.pop(); 
                // ê·¸ ì´ì „ í† í°ì„ ì‚¬ìš©
                const prevToken = pageTokens.prev.pop(); 
                handleSearch(prevToken);
            });
            dom.nextPageBtn.addEventListener('click', () => {
                handleSearch(pageTokens.next);
            });

            // "ë”ë³´ê¸°/ì ‘ê¸°" (ì´ë²¤íŠ¸ ìœ„ì„)
            dom.resultsContainer.addEventListener('click', (e) => {
                const target = e.target;
                if (!target.classList.contains('description-toggle')) return;
                
                e.preventDefault();
                
                const descriptionElem = target.previousElementSibling;
                const card = target.closest('.video-card');
                const videoId = card.dataset.videoId;
                
                const isExpanded = target.getAttribute('aria-expanded') === 'true';
                
                if (isExpanded) {
                    descriptionElem.innerHTML = descriptionElem.dataset.short.replace(/\n/g, '<br>');
                    target.textContent = 'ë”ë³´ê¸°';
                    target.setAttribute('aria-expanded', 'false');
                    target.setAttribute('aria-controls', `desc-${videoId}`);
                } else {
                    descriptionElem.innerHTML = descriptionElem.dataset.full.replace(/\n/g, '<br>');
                    target.textContent = 'ì ‘ê¸°';
                    target.setAttribute('aria-expanded', 'true');
                    target.setAttribute('aria-controls', `desc-${videoId}`);
                }
            });
            
            // (í‚¤ë³´ë“œ ì ‘ê·¼ì„±) ìŠ¤í˜ì´ìŠ¤/ì—”í„°ë¡œ ë”ë³´ê¸° í† ê¸€
            dom.resultsContainer.addEventListener('keydown', (e) => {
                if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('description-toggle')) {
                    e.preventDefault();
                    e.target.click();
                }
            });
            

            // --- ì´ˆê¸°í™” ë¡œì§ ---

            /**
             * ìƒë‹¨ ë°” ë†’ì´ì— ë§ì¶° body íŒ¨ë”© ì¡°ì ˆ
             */
            function updateBodyPadding() {
                const searchBarHeight = dom.searchBar.offsetHeight;
                const bannerHeight = dom.warningBanner.offsetHeight;
                const totalPadding = (dom.warningBanner.style.display === 'none' ? 0 : bannerHeight) + searchBarHeight;
                
                document.body.style.paddingTop = `${totalPadding + 10}px`;
                dom.warningBanner.style.top = `${searchBarHeight}px`;
            }

            // ì´ˆê¸° ë¡œë“œ
            loadSettings();
            updateBodyPadding();
            updatePagination(null); // ì´ˆê¸° í˜ì´ì§€ë„¤ì´ì…˜ ìˆ¨ê¹€

            // ì°½ í¬ê¸° ë³€ê²½ ì‹œ íŒ¨ë”© ì¬ì¡°ì •
            window.addEventListener('resize', debounce(updateBodyPadding, 100));

            // file:// ê²½ê³ 
            if (window.location.protocol === 'file:') {
                console.warn(
                    "file:// í”„ë¡œí† ì½œë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. API ìš”ì²­ì´ Referrer Policy " +
                    "(e.g., 'strict-origin-when-cross-origin')ë¡œ ì¸í•´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. " +
                    "ë¡œì»¬ ì›¹ ì„œë²„(ì˜ˆ: VSCode Live Server) ì‚¬ìš©ì„ ê°•ë ¥íˆ ê¶Œì¥í•©ë‹ˆë‹¤."
                );
            }

        }); // DOMContentLoaded End
    </script>

</body>
</html>