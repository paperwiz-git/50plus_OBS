<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ì±„ë„ íƒìƒ‰ê¸° (vling.net ìŠ¤íƒ€ì¼)</title>
    <!-- 
      YouTube ì±„ë„ íƒìƒ‰ê¸° v2.0 (PLAN B)
      =================================
      
      [vling.net ë²¤ì¹˜ë§ˆí‚¹ ê°œí¸]
      - "ì˜ìƒ ê²€ìƒ‰"ì—ì„œ "ì±„ë„ ê²€ìƒ‰" (type=channel)ìœ¼ë¡œ ì•±ì˜ ëª©ì ì„ ì™„ì „íˆ ë³€ê²½.
      - 2ë‹¨ê³„ API í˜¸ì¶œ:
        1. search.list (type=channel): í‚¤ì›Œë“œë¡œ ì±„ë„ ID ëª©ë¡ ê²€ìƒ‰
        2. channels.list: íšë“í•œ IDë¡œ ê° ì±„ë„ì˜ í†µê³„(êµ¬ë…ì, ì¡°íšŒìˆ˜) ìƒì„¸ ì¡°íšŒ
      - í•„í„° ì „ë©´ ê°œí¸:
        - [ì œê±°] ê¸°ê°„, ì˜ìƒ ê¸¸ì´
        - [ì¶”ê°€] êµ­ê°€ (regionCode)
        - [ì¶”ê°€] êµ¬ë…ì ìˆ˜ (API ì œí•œìœ¼ë¡œ "ê²€ìƒ‰ í›„ í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§" ë°©ì‹ìœ¼ë¡œ ë™ì‘)
      - UI ì „ë©´ ê°œí¸:
        - "ì˜ìƒ ì¹´ë“œ/í…Œì´ë¸”" -> "ì±„ë„ ì¹´ë“œ/í…Œì´ë¸”"
        - êµ¬ë…ì ìˆ˜, ì´ ì¡°íšŒìˆ˜, ì´ ì˜ìƒ ìˆ˜ ë“± ì±„ë„ í†µê³„ ì¤‘ì‹¬ìœ¼ë¡œ í‘œì‹œ
        - vling.netê³¼ ìœ ì‚¬í•˜ê²Œ í…Œì´ë¸” ë·°ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •.

      [ì‚¬ìš© ë°©ë²•]
      1. Google Cloud Consoleì—ì„œ "YouTube Data API v3" API í‚¤ ë°œê¸‰.
      2. API í‚¤ë¥¼ ì•„ë˜ "API Key" ì…ë ¥ì¹¸ì— ë¶™ì—¬ë„£ê¸°.
      3. ê²€ìƒ‰ì–´(ì˜ˆ: ì‹œë‹ˆì–´ ê±´ê°•, ê²½ì œ)ì™€ í•„í„°(êµ­ê°€, êµ¬ë…ì ìˆ˜)ë¥¼ ì„ íƒ.
      4. ì—”í„° ë˜ëŠ” ê²€ìƒ‰ì–´ ì…ë ¥ì„ ë©ˆì¶”ë©´(ë””ë°”ìš´ìŠ¤) ìë™ ê²€ìƒ‰ ì‹¤í–‰.

      [ì¤‘ìš”: êµ¬ë…ì ìˆ˜ í•„í„°ì˜ í•œê³„]
      - YouTube APIëŠ” ê²€ìƒ‰ ì‹œ 'êµ¬ë…ì ìˆ˜'ë¡œ í•„í„°ë§í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      - ì´ ì•±ì€ ë¨¼ì € APIë¡œ ìµœëŒ€ 50ê°œì˜ ì±„ë„ì„ ê°€ì ¸ì˜¨ í›„, 
        *ê·¸ ê²°ê³¼ ë‚´ì—ì„œ* ì„¤ì •í•˜ì‹  êµ¬ë…ì ìˆ˜ ë²”ìœ„ì— ë§ëŠ” ì±„ë„ë§Œ ë³´ì—¬ì¤ë‹ˆë‹¤.
      - ì˜ˆ: "100ë§Œ ì´ìƒ" ì„ íƒ ì‹œ, APIê°€ ë°˜í™˜í•œ 50ê°œ ì¤‘ 100ë§Œ ì´ìƒ ì±„ë„ì´
        ì—†ìœ¼ë©´ ê²°ê³¼ê°€ 0ê°œë¡œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (Vlingê°™ì€ ìœ ë£Œ ì„œë¹„ìŠ¤ì™€ ë‹¤ë¦„)
    -->
    <style>
        /* --- ë³€ìˆ˜ ë° ê¸°ë³¸ ì„¤ì • --- */
        :root {
            --color-red: #E53935;     /* ê²€ìƒ‰/ì‹¤í–‰/ì—ëŸ¬ */
            --color-blue: #1E88E5;    /* ë³´ì¡°/ì˜µì…˜/ì •ë³´ */
            --color-green: #43A047;   /* ë¦¬ì…‹/í† ê¸€/ì„±ê³µ/ë‚´ë³´ë‚´ê¸° */
            --color-text: #111;
            --color-bg: #ffffff;
            --color-border: #E5E7EB;
            --color-bg-alt: #f9fafb;
            --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë¦¬ì…‹ --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            padding-top: 180px; /* ìƒë‹¨ ê³ ì • ë°” ë†’ì´ë§Œí¼ íŒ¨ë”© (ìœ ë™ì ìœ¼ë¡œ ì¡°ì ˆë¨) */
        }

        /* --- ì ‘ê·¼ì„± --- */
        *:focus-visible {
            outline: 2px solid var(--color-blue);
            outline-offset: 2px;
            border-radius: var(--radius-md);
        }

        /* --- ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ --- */
        .hidden {
            display: none !important;
        }

        /* --- ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            background-color: var(--color-bg);
            color: var(--color-text);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            white-space: nowrap;
        }
        .btn:hover, .btn:focus-visible {
            border-color: #9ca3af;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn:active {
            transform: translateY(1px);
        }

        .btn-danger { background-color: var(--color-red); color: white; border-color: var(--color-red); }
        .btn-danger:hover { background-color: #d32f2f; border-color: #d32f2f; }
        
        .btn-primary { background-color: var(--color-blue); color: white; border-color: var(--color-blue); }
        .btn-primary:hover { background-color: #1976D2; border-color: #1976D2; }
        
        .btn-success { background-color: var(--color-green); color: white; border-color: var(--color-green); }
        .btn-success:hover { background-color: #388E3C; border-color: #388E3C; }

        /* --- ì…ë ¥ì¹¸ ìŠ¤íƒ€ì¼ --- */
        .input-field, .select-field {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            background-color: white;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .input-field:focus, .select-field:focus {
            border-color: var(--color-blue);
            box-shadow: 0 0 0 2px rgba(30, 136, 229, 0.2);
            outline: none;
        }

        /* --- ìƒë‹¨ ê²€ìƒ‰ ë°” --- */
        .search-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--color-bg);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem;
            box-shadow: var(--shadow-light);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .search-bar-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.75rem;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        #api-key-input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            flex-grow: 1;
            min-width: 150px;
        }
        #api-key-toggle {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            border-left: 0;
        }

        #search-query {
            flex-grow: 1;
            font-size: 1rem;
            min-width: 200px;
        }
        
        .crypto-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        #crypto-password {
            width: 120px;
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.75rem;
        }

        /* --- ê²½ê³  ë°°ë„ˆ --- */
        .warning-banner {
            position: fixed;
            top: 0; /* JSë¡œ search-bar ë†’ì´ë§Œí¼ ë™ì  ì„¤ì •ë¨ */
            left: 0;
            right: 0;
            background-color: #fffbeb;
            border: 1px solid #fde68a;
            color: #b45309;
            padding: 0.75rem 1rem;
            z-index: 999;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }
        #close-banner-btn {
            background: none;
            border: none;
            color: #b45309;
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.25rem;
        }

        /* --- ë¡œë” --- */
        .loader {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            margin: 4rem auto;
            border: 6px solid #f3f3f3;
            border-top: 6px solid var(--color-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ --- */
        .content-area {
            padding: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* --- ê²°ê³¼ ì—†ìŒ ë©”ì‹œì§€ --- */
        #no-results-message {
            text-align: center;
            font-size: 1.1rem;
            color: #6b7280;
            padding: 3rem 1rem;
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-lg);
        }

        /* --- (ì‹ ê·œ) ì±„ë„ ì¹´ë“œ ë·° (Grid) --- */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .channel-card {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: box-shadow 0.2s ease;
        }
        .channel-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .channel-banner {
            width: 100%;
            height: 80px;
            background-color: var(--color-bg-alt);
            object-fit: cover;
        }
        .channel-content {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: -40px; /* ë¡œê³ ê°€ ë°°ë„ˆ ìœ„ë¡œ ì˜¬ë¼ì˜¤ê²Œ */
            flex-grow: 1;
        }
        .channel-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: var(--shadow-light);
            background-color: white;
            object-fit: cover;
        }
        .channel-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-text);
            text-decoration: none;
            margin-top: 0.75rem;
        }
        .channel-title:hover {
            color: var(--color-blue);
        }
        .channel-description {
            font-size: 0.875rem;
            color: #4b5563;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-top: 0.5rem;
            text-align: center;
            height: 44px; /* 2ì¤„ ë†’ì´ ê³ ì • */
        }
        .channel-stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--color-border);
            text-align: center;
        }
        .stat-item {
            font-size: 0.875rem;
            color: #374151;
        }
        .stat-item strong {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text);
        }

        /* --- (ì‹ ê·œ) ì±„ë„ í…Œì´ë¸” ë·° (Table) --- */
        .results-table-wrapper {
            overflow-x: auto;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            min-width: 1200px; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ìƒì„± */
        }
        .results-table th, .results-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--color-border);
            text-align: left;
            vertical-align: middle;
        }
        .results-table th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
        }
        .results-table tr:last-child td {
            border-bottom: 0;
        }
        .results-table tr:hover {
            background-color: #fcfcfc;
        }
        .table-logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .table-logo {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }
        .table-channel-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--color-text);
            text-decoration: none;
        }
        .table-channel-title:hover {
            color: var(--color-blue);
        }
        .table-description {
            max-width: 350px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .stat-strong {
            font-size: 1rem;
            font-weight: 500;
            color: var(--color-text);
        }
        .stat-hidden {
            color: #9ca3af;
        }

        /* --- í˜ì´ì§€ë„¤ì´ì…˜ --- */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        .pagination .btn {
            min-width: 100px;
        }

        /* --- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ --- */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .toast {
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            font-weight: 500;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
        }
        .toast.success {
            background-color: var(--color-green);
            color: white;
        }
        .toast.error {
            background-color: var(--color-red);
            color: white;
        }
        .toast.info {
            background-color: var(--color-blue);
            color: white;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; transform: translateX(100%); }
        }

        /* --- ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ --- */
        @media (max-width: 1024px) {
            body { padding-top: 220px; } /* ë°” ë†’ì´ ì¦ê°€ */
        }
        @media (max-width: 768px) {
            body { padding-top: 260px; } /* ë°” ë†’ì´ ì¦ê°€ */
            .content-area { padding: 1rem; }
            .results-grid {
                grid-template-columns: 1fr; /* ëª¨ë°”ì¼ì—ì„  1ì—´ */
                gap: 1rem;
            }
            .search-bar {
                padding: 0.75rem;
            }
            .search-bar-row {
                gap: 0.5rem;
            }
            .btn {
                padding: 0.5rem 0.6rem;
                font-size: 0.8rem;
            }
            .input-field, .select-field {
                font-size: 0.8rem;
                padding: 0.5rem 0.6rem;
            }
            .crypto-group {
                flex-wrap: wrap;
            }
            #crypto-password {
                width: 100px;
            }
        }
        @media (max-width: 480px) {
             body { padding-top: 360px; } /* ë°” ë†’ì´ ì¦ê°€ */
             .filter-group, .action-group {
                width: 100%;
                justify-content: space-between;
             }
             .select-field {
                 flex-grow: 1;
             }
        }

    </style>
</head>
<body>

    <!-- ìƒë‹¨ ê³ ì • ê²€ìƒ‰ ë°” -->
    <header class="search-bar" id="search-bar">
        <!-- 1í–‰: API í‚¤ ë° ê²€ìƒ‰ì–´ -->
        <div class="search-bar-row">
            <div class="input-group">
                <label for="api-key-input" class="hidden">API Key</label>
                <input type="password" id="api-key-input" class="input-field" placeholder="YouTube API Key ì…ë ¥">
                <button id="api-key-toggle" class="btn" aria-label="API í‚¤ í‘œì‹œ/ìˆ¨ê¹€">ğŸ‘ï¸</button>
            </div>
            
            <div class="crypto-group">
                <label for="crypto-password" class="hidden">ì•”í˜¸í™” ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="crypto-password" class="input-field" placeholder="í‚¤ ì•”í˜¸">
                <button id="save-key-btn" class="btn btn-primary" title="í˜„ì¬ API í‚¤ë¥¼ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¡œ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.">í‚¤ ì €ì¥</button>
                <button id="load-key-btn" class="btn btn-success" title="ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¡œ ì €ì¥ëœ API í‚¤ë¥¼ ë³µí˜¸í™”í•˜ì—¬ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.">í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>
        
        <div class="search-bar-row">
             <label for="search-query" class="hidden">ê²€ìƒ‰ì–´</label>
             <input type="search" id="search-query" class="input-field" placeholder="ì±„ë„ ê²€ìƒ‰ì–´ ì…ë ¥ í›„ Enter (ì˜ˆ: ì‹œë‹ˆì–´ ê±´ê°•)">
        </div>

        <!-- 2í–‰: í•„í„° (ì±„ë„ìš©ìœ¼ë¡œ ì „ë©´ ê°œí¸) -->
        <div class="search-bar-row filter-group">
            <label for="region-code" class="hidden">êµ­ê°€</label>
            <select id="region-code" class="select-field">
                <option value="any">ì „ì²´ êµ­ê°€</option>
                <option value="KR">ëŒ€í•œë¯¼êµ­ ğŸ‡°ğŸ‡·</option>
                <option value="US">ë¯¸êµ­ ğŸ‡ºğŸ‡¸</option>
                <option value="JP">ì¼ë³¸ ğŸ‡¯ğŸ‡µ</option>
                <option value="GB">ì˜êµ­ ğŸ‡¬ğŸ‡§</option>
                <option value="IN">ì¸ë„ ğŸ‡®ğŸ‡³</option>
                <option value="VN">ë² íŠ¸ë‚¨ ğŸ‡»ğŸ‡³</option>
            </select>
            
            <label for="subscriber-count" class="hidden">êµ¬ë…ì ìˆ˜</label>
            <select id="subscriber-count" class="select-field">
                <option value="any">êµ¬ë…ì ì „ì²´</option>
                <option value="0-10k">~ 1ë§Œ</option>
                <option value="10k-100k">1ë§Œ ~ 10ë§Œ</option>
                <option value="100k-500k">10ë§Œ ~ 50ë§Œ</option>
                <option value="500k-1m">50ë§Œ ~ 100ë§Œ</option>
                <option value="1m+">100ë§Œ ì´ìƒ</option>
            </select>
            
            <label for="sort-order" class="hidden">ì •ë ¬</label>
            <select id="sort-order" class="select-field">
                <option value="relevance">ê´€ë ¨ì„±</option>
                <option value="date">ìƒì„±ì¼ìˆœ</option>
                <option value="viewCount">ì´ ì¡°íšŒìˆ˜ìˆœ</option>
                <option value="videoCount">ì´ ì˜ìƒ ìˆ˜ìˆœ</option>
            </select>
            
            <label for="result-count" class="hidden">ê°œìˆ˜</label>
            <select id="result-count" class="select-field">
                <option value="10">10ê°œ</option>
                <option value="20">20ê°œ</option>
                <option value="30">30ê°œ</option>
                <option value="50">50ê°œ</option>
            </select>
        </div>

        <!-- 3í–‰: ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="search-bar-row action-group">
            <button id="view-toggle-btn" class="btn btn-primary">ë³´ê¸°: ì¹´ë“œ</button>
            <button id="reset-btn" class="btn btn-success">í•„í„° ë¦¬ì…‹</button>
            <button id="export-csv-btn" class="btn btn-success">Export CSV</button>
            <button id="copy-json-btn" class="btn btn-success">Copy JSON</button>
            <button id="api-test-btn" class="btn btn-danger">API í…ŒìŠ¤íŠ¸</button>
        </div>
    </header>

    <!-- ê²½ê³  ë°°ë„ˆ -->
    <div class="warning-banner" id="warning-banner">
        <span>âš ï¸ <strong>ì£¼ì˜:</strong> API í‚¤ê°€ ë¸Œë¼ìš°ì €ì— ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í˜ì´ì§€ë¥¼ ê³µê°œì ìœ¼ë¡œ ê³µìœ í•˜ì§€ ë§ˆì„¸ìš”.<br>
              ë¡œì»¬ì—ì„œ `file://`ë¡œ ì‹¤í–‰ ì‹œ API ìš”ì²­ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë¡œì»¬ ì„œë²„ ê¶Œì¥).</span>
        <button id="close-banner-btn" aria-label="ë°°ë„ˆ ë‹«ê¸°">&times;</button>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="content-area">
        <!-- ë¡œë” -->
        <div class="loader" id="loader"></div>
        
        <!-- ê²°ê³¼ ì»¨í…Œì´ë„ˆ -->
        <div id="results-container">
            <!-- ë™ì  ì»¨í…ì¸  (ì¹´ë“œ ë˜ëŠ” í…Œì´ë¸”) -->
        </div>

        <!-- ê²°ê³¼ ì—†ìŒ ë©”ì‹œì§€ -->
        <div id="no-results-message" class="hidden">
            <p>ê²€ìƒ‰ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.<br>ê²€ìƒ‰ì–´ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ í•„í„°ë¥¼ ì¡°ì •í•´ ë³´ì„¸ìš”.</p>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <nav class="pagination" id="pagination-controls">
            <button id="prev-page-btn" class="btn" disabled>&larr; ì´ì „</button>
            <button id="next-page-btn" class="btn" disabled>ë‹¤ìŒ &rarr;</button>
        </nav>
    </main>

    <!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div class="toast-container" id="toast-container"></div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM ìš”ì†Œ ---
            const dom = {
                searchBar: document.getElementById('search-bar'),
                apiKeyInput: document.getElementById('api-key-input'),
                apiKeyToggle: document.getElementById('api-key-toggle'),
                cryptoPasswordInput: document.getElementById('crypto-password'),
                saveKeyBtn: document.getElementById('save-key-btn'),
                loadKeyBtn: document.getElementById('load-key-btn'),
                searchQueryInput: document.getElementById('search-query'),
                // [ê°œí¸] í•„í„° ìš”ì†Œ ë³€ê²½
                regionCodeSelect: document.getElementById('region-code'),
                subscriberCountSelect: document.getElementById('subscriber-count'),
                sortOrderSelect: document.getElementById('sort-order'),
                resultCountSelect: document.getElementById('result-count'),
                // [ê°œí¸] ì•¡ì…˜ ë²„íŠ¼
                viewToggleBtn: document.getElementById('view-toggle-btn'),
                resetBtn: document.getElementById('reset-btn'),
                exportCsvBtn: document.getElementById('export-csv-btn'),
                copyJsonBtn: document.getElementById('copy-json-btn'),
                apiTestBtn: document.getElementById('api-test-btn'),
                // [ê°œí¸] ê¸°íƒ€ UI
                warningBanner: document.getElementById('warning-banner'),
                closeBannerBtn: document.getElementById('close-banner-btn'),
                loader: document.getElementById('loader'),
                resultsContainer: document.getElementById('results-container'),
                noResultsMessage: document.getElementById('no-results-message'),
                paginationControls: document.getElementById('pagination-controls'),
                prevPageBtn: document.getElementById('prev-page-btn'),
                nextPageBtn: document.getElementById('next-page-btn'),
                toastContainer: document.getElementById('toast-container'),
            };

            // --- ìƒíƒœ ë³€ìˆ˜ ---
            const YOUTUBE_API_BASE = 'https://www.googleapis.com/youtube/v3';
            let apiKey = '';
            let currentView = 'table'; // [ê°œí¸] vlingì²˜ëŸ¼ í…Œì´ë¸”ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ
            let currentResults = []; // [ê°œí¸] í˜„ì¬ ë¡œë“œëœ *ì±„ë„* ë°ì´í„°
            let pageTokens = { next: null, prev: [] };
            let searchCache = new Map();
            let searchTimeout;

            // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

            /**
             * í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
             */
            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                dom.toastContainer.appendChild(toast);
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }

            /**
             * ë¡œë” í‘œì‹œ/ìˆ¨ê¹€
             */
            function showLoader(show) {
                dom.loader.style.display = show ? 'block' : 'none';
            }

            /**
             * "ê²°ê³¼ ì—†ìŒ" ë©”ì‹œì§€ í‘œì‹œ/ìˆ¨ê¹€
             */
            function showNoResults(show) {
                dom.noResultsMessage.classList.toggle('hidden', !show);
            }

            /**
             * ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜
             */
            function debounce(func, delay) {
                return function(...args) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => func.apply(this, args), delay);
                };
            }

            /**
             * [ì‹ ê·œ] êµ¬ë…ì ìˆ˜ í¬ë§· (vling ìŠ¤íƒ€ì¼: 1.5ë§Œ, 120ë§Œ)
             */
            function formatSubscriberCount(numStr) {
                const n = parseInt(numStr, 10);
                if (isNaN(n)) return 'N/A';
                if (n < 1000) return n.toString();
                if (n < 10000) return (n / 1000).toFixed(1) + 'ì²œ';
                if (n < 100000000) {
                    const man = (n / 10000);
                    if (man < 10) return man.toFixed(1) + 'ë§Œ';
                    return Math.floor(man) + 'ë§Œ';
                }
                return (n / 100000000).toFixed(1) + 'ì–µ';
            }

            /**
             * ë‚ ì§œ í¬ë§· (Asia/Seoul)
             */
            function formatDate(isoString) {
                try {
                    return new Date(isoString).toLocaleString('ko-KR', {
                        timeZone: 'Asia/Seoul',
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                    });
                } catch (e) {
                    return 'N/A';
                }
            }

            /**
             * ìˆ«ì ì½¤ë§ˆ í¬ë§·
             */
            function formatNumber(num) {
                try {
                    return parseInt(num, 10).toLocaleString('ko-KR');
                } catch (e) {
                    return '0';
                }
            }

            /**
             * HTML íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
             */
            function escapeHTML(str) {
                if (!str) return '';
                return str.replace(/[&<>"']/g, function(m) {
                    return {
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#39;'
                    }[m];
                });
            }

            /**
             * CSV ë‚´ìš© ì´ìŠ¤ì¼€ì´í”„
             */
            function escapeCSV(str) {
                if (str === null || str === undefined) return '';
                str = String(str);
                if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                    return `"${str.replace(/"/g, '""')}"`;
                }
                return str;
            }


            // --- localStorage ì„¤ì • ì €ì¥/ë¡œë“œ (ê°œí¸) ---

            function saveSettings() {
                const settings = {
                    query: dom.searchQueryInput.value,
                    region: dom.regionCodeSelect.value,
                    subs: dom.subscriberCountSelect.value,
                    sort: dom.sortOrderSelect.value,
                    count: dom.resultCountSelect.value,
                    view: currentView
                };
                localStorage.setItem('youtubeChannelSettings', JSON.stringify(settings));
            }

            function loadSettings() {
                const settings = JSON.parse(localStorage.getItem('youtubeChannelSettings') || '{}');
                
                dom.searchQueryInput.value = settings.query || '';
                dom.regionCodeSelect.value = settings.region || 'any';
                dom.subscriberCountSelect.value = settings.subs || 'any';
                dom.sortOrderSelect.value = settings.sort || 'relevance';
                dom.resultCountSelect.value = settings.count || '10';
                
                if (settings.view === 'grid') {
                    toggleView(true); // ë·° ì „í™˜
                }

                if (localStorage.getItem('youtubeApiKey_iv')) {
                    showToast('ì €ì¥ëœ ì•”í˜¸í™” í‚¤ê°€ ìˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¡œ "í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°"ë¥¼ í•˜ì„¸ìš”.', 'info');
                }
            }

            /**
             * í•„í„° ë¦¬ì…‹ (ê°œí¸)
             */
            function resetSettings() {
                localStorage.removeItem('youtubeChannelSettings');
                dom.searchQueryInput.value = '';
                dom.regionCodeSelect.value = 'any';
                dom.subscriberCountSelect.value = 'any';
                dom.sortOrderSelect.value = 'relevance';
                dom.resultCountSelect.value = '10';
                
                currentResults = [];
                pageTokens = { next: null, prev: [] };
                searchCache.clear();
                renderResults([]);
                updatePagination(null);
                
                showToast('í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }


            // --- API í‚¤ ì•”í˜¸í™” (ë³€ê²½ ì—†ìŒ) ---
            const enc = new TextEncoder();
            const dec = new TextDecoder();
            
            function ab2b64(buffer) {
                let binary = '';
                const bytes = new Uint8Array(buffer);
                const len = bytes.byteLength;
                for (let i = 0; i < len; i++) {
                    binary += String.fromCharCode(bytes[i]);
                }
                return window.btoa(binary);
            }
            
            function b642ab(base64) {
                const binary_string = window.atob(base64);
                const len = binary_string.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binary_string.charCodeAt(i);
                }
                return bytes.buffer;
            }

            async function getKey(password, salt) {
                const keyMaterial = await crypto.subtle.importKey(
                    "raw",
                    enc.encode(password),
                    "PBKDF2",
                    false,
                    ["deriveKey"]
                );
                return crypto.subtle.deriveKey(
                    {
                        name: "PBKDF2",
                        salt: salt,
                        iterations: 150000,
                        hash: "SHA-256"
                    },
                    keyMaterial,
                    { name: "AES-GCM", length: 256 },
                    true,
                    ["encrypt", "decrypt"]
                );
            }

            async function encryptAndStoreKey() {
                const password = dom.cryptoPasswordInput.value;
                const keyToStore = dom.apiKeyInput.value;
                if (!password || !keyToStore) {
                    showToast('API í‚¤ì™€ ì•”í˜¸í™” ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                    return;
                }
                try {
                    const salt = crypto.getRandomValues(new Uint8Array(16));
                    const iv = crypto.getRandomValues(new Uint8Array(12));
                    const key = await getKey(password, salt);
                    const encryptedData = await crypto.subtle.encrypt(
                        { name: "AES-GCM", iv: iv },
                        key,
                        enc.encode(keyToStore)
                    );
                    localStorage.setItem('youtubeApiKey_salt', ab2b64(salt));
                    localStorage.setItem('youtubeApiKey_iv', ab2b64(iv));
                    localStorage.setItem('youtubeApiKey_data', ab2b64(encryptedData));
                    dom.cryptoPasswordInput.value = '';
                    showToast('API í‚¤ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í–ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (e) {
                    console.error("í‚¤ ì €ì¥ ì‹¤íŒ¨:", e);
                    showToast(`í‚¤ ì €ì¥ ì‹¤íŒ¨: ${e.message}`, 'error');
                }
            }

            async function loadAndDecryptKey() {
                const password = dom.cryptoPasswordInput.value;
                if (!password) {
                    showToast('ì•”í˜¸í™” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                    return;
                }
                const salt_b64 = localStorage.getItem('youtubeApiKey_salt');
                const iv_b64 = localStorage.getItem('youtubeApiKey_iv');
                const data_b64 = localStorage.getItem('youtubeApiKey_data');
                if (!salt_b64 || !iv_b64 || !data_b64) {
                    showToast('ì €ì¥ëœ ì•”í˜¸í™” í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                try {
                    const salt = b642ab(salt_b64);
                    const iv = b642ab(iv_b64);
                    const encryptedData = b642ab(data_b64);
                    const key = await getKey(password, salt);
                    const decryptedData = await crypto.subtle.decrypt(
                        { name: "AES-GCM", iv: iv },
                        key,
                        encryptedData
                    );
                    const decryptedKey = dec.decode(decryptedData);
                    dom.apiKeyInput.value = decryptedKey;
                    apiKey = decryptedKey;
                    dom.cryptoPasswordInput.value = '';
                    showToast('API í‚¤ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
                } catch (e) {
                    console.error("í‚¤ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", e);
                    showToast('í‚¤ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ê±°ë‚˜ ë°ì´í„°ê°€ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }


            // --- API í˜¸ì¶œ ë¡œì§ (ì±„ë„ìš© ê°œí¸) ---

            /**
             * API ì—ëŸ¬ í•¸ë“¤ëŸ¬ (ë³€ê²½ ì—†ìŒ)
             */
            function handleApiError(error, response = null) {
                console.error("API Error:", error, response);
                showLoader(false);
                let message = `API ìš”ì²­ ì‹¤íŒ¨: ${error.message}`;
                if (window.location.protocol === 'file:') {
                    message += '\n[file://] í”„ë¡œí† ì½œ ê°ì§€. ë¡œì»¬ ì„œë²„ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.';
                }
                if (response && response.error) {
                    const apiError = response.error;
                    message = `[${apiError.code}] ${apiError.message}\n`;
                    const reason = apiError.errors?.[0]?.reason;
                    if (reason === 'keyInvalid') {
                        message += 'API í‚¤ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    } else if (reason === 'quotaExceeded') {
                        message += 'API í• ë‹¹ëŸ‰(ì¿¼í„°)ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.';
                    } else if (reason === 'forbidden') {
                        message += 'API ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤ (IP/ë¦¬í¼ëŸ¬ ì œí•œ ë“±).';
                    }
                }
                showToast(message.replace(/\n/g, ' '), 'error');
            }

            /**
             * ë©”ì¸ ê²€ìƒ‰ í•¨ìˆ˜ (ì±„ë„ìš© ê°œí¸)
             * @param {string | null} pageToken - í˜ì´ì§€ í† í° (ë‹¤ìŒ/ì´ì „)
             */
            async function handleSearch(pageToken = null) {
                apiKey = dom.apiKeyInput.value;
                if (!apiKey) {
                    showToast('YouTube API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                    return;
                }

                if (pageToken === null) {
                    pageTokens = { next: null, prev: [] };
                }

                const query = dom.searchQueryInput.value.trim();
                const sortOrder = dom.sortOrderSelect.value;
                const maxResults = dom.resultCountSelect.value;
                const regionCode = dom.regionCodeSelect.value;
                // êµ¬ë…ì ìˆ˜ í•„í„°ëŠ” API í˜¸ì¶œ í›„ ì ìš©
                
                if (!query) {
                    showToast('ì±„ë„ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'info');
                    return;
                }

                // 1. search.list API (ì±„ë„ ID ëª©ë¡ ê°€ì ¸ì˜¤ê¸°)
                const searchParams = new URLSearchParams({
                    part: 'snippet',
                    type: 'channel', // [í•µì‹¬] ì±„ë„ ê²€ìƒ‰
                    q: query,
                    order: sortOrder,
                    maxResults: maxResults,
                    key: apiKey,
                });

                if (regionCode !== 'any') {
                    searchParams.set('regionCode', regionCode);
                }
                if (pageToken) {
                    searchParams.set('pageToken', pageToken);
                }
                
                const searchUrl = `${YOUTUBE_API_BASE}/search?${searchParams.toString()}`;

                if (!pageToken && searchCache.has(searchUrl)) {
                    const cachedData = searchCache.get(searchUrl);
                    console.log("Using cached search data...");
                    await processChannelIds(cachedData, pageToken); // [ê°œí¸]
                    return;
                }

                showLoader(true);
                showNoResults(false);
                dom.resultsContainer.innerHTML = '';

                try {
                    const response = await fetch(searchUrl);
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error?.message || response.statusText);
                    }
                    
                    if (!pageToken) {
                        searchCache.set(searchUrl, data);
                    }
                    
                    await processChannelIds(data, pageToken); // [ê°œí¸]

                } catch (error) {
                    handleApiError(error, error.response?.data);
                } finally {
                    showLoader(false);
                    saveSettings();
                }
            }

            /**
             * [ì‹ ê·œ] 1ë‹¨ê³„(search) ì™„ë£Œ í›„ 2ë‹¨ê³„(channels) í˜¸ì¶œ
             */
            async function processChannelIds(searchData, originalPageToken) {
                const channelItems = searchData.items;

                if (!channelItems || channelItems.length === 0) {
                    showNoResults(true);
                    updatePagination(null);
                    return;
                }

                // search.list ê²°ê³¼ì—ì„œ channelId ì¶”ì¶œ
                const channelIds = channelItems.map(item => item.id.channelId).join(',');
                
                // í˜ì´ì§€ë„¤ì´ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (originalPageToken !== pageTokens.prev[pageTokens.prev.length - 1]) {
                    pageTokens.prev.push(searchData.prevPageToken);
                }
                pageTokens.next = searchData.nextPageToken || null;
                
                updatePagination(searchData);

                // 2. channels.list API (ìƒì„¸ í†µê³„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°)
                const channelsParams = new URLSearchParams({
                    part: 'snippet,statistics,brandingSettings', // í†µê³„, ë¸Œëœë”©(ë°°ë„ˆ) ì •ë³´
                    id: channelIds,
                    key: apiKey,
                });
                const channelsUrl = `${YOUTUBE_API_BASE}/channels?${channelsParams.toString()}`;

                const chResponse = await fetch(channelsUrl);
                const chData = await chResponse.json();

                if (!chResponse.ok) {
                    throw new Error(chData.error?.message || chResponse.statusText);
                }

                let results = chData.items || [];
                const originalCount = results.length;

                // [í•µì‹¬] êµ¬ë…ì ìˆ˜ í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§
                const subFilter = dom.subscriberCountSelect.value;
                if (subFilter !== 'any') {
                    results = results.filter(channel => {
                        const stats = channel.statistics;
                        if (!stats || stats.hiddenSubscriberCount) return false;
                        const count = parseInt(stats.subscriberCount, 10);
                        
                        switch (subFilter) {
                            case '0-10k': return count < 10000;
                            case '10k-100k': return count >= 10000 && count < 100000;
                            case '100k-500k': return count >= 100000 && count < 500000;
                            case '500k-1m': return count >= 500000 && count < 1000000;
                            case '1m+': return count >= 1000000;
                            default: return true;
                        }
                    });

                    // í•„í„°ë§ìœ¼ë¡œ ê²°ê³¼ê°€ 0ì´ ëœ ê²½ìš°, ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                    if (results.length === 0 && originalCount > 0) {
                        showToast(`API ê²€ìƒ‰ ${originalCount}ê°œ ì¤‘ êµ¬ë…ì ìˆ˜(${subFilter}) í•„í„°ì™€ ì¼ì¹˜í•˜ëŠ” ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.`, 'info');
                    }
                }

                currentResults = results;
                renderResults(currentResults);
            }


            // --- ë Œë”ë§ ë¡œì§ (ì±„ë„ìš© ê°œí¸) ---

            /**
             * ê²°ê³¼ ë Œë”ë§ (ë·°ì— ë”°ë¼ ë¶„ê¸°)
             */
            function renderResults(results) {
                showNoResults(results.length === 0 && dom.loader.style.display === 'none');
                dom.resultsContainer.innerHTML = '';
                
                if (currentView === 'grid') {
                    renderGridView(results);
                } else {
                    renderTableView(results);
                }
            }

            /**
             * [ì‹ ê·œ] ì¹´ë“œ ë·° ë Œë”ë§ (ì±„ë„ìš©)
             */
            function renderGridView(results) {
                const grid = document.createElement('div');
                grid.className = 'results-grid';
                
                grid.innerHTML = results.map(item => {
                    const snippet = item.snippet || {};
                    const stats = item.statistics || {};
                    const branding = item.brandingSettings || {};

                    const channelId = item.id;
                    const title = escapeHTML(snippet.title);
                    const url = `https://www.youtube.com/channel/${channelId}`;
                    const logoUrl = snippet.thumbnails?.medium?.url || 'https://placehold.co/80x80/e0e0e0/757575?text=Logo';
                    const bannerUrl = branding.image?.bannerExternalUrl || 'https://placehold.co/300x80/f0f0f0/ccc?text=Banner';
                    
                    const subCount = stats.hiddenSubscriberCount ? 'ë¹„ê³µê°œ' : formatSubscriberCount(stats.subscriberCount);
                    const viewCount = formatSubscriberCount(stats.viewCount); // ë™ì¼ í¬ë§· ì‚¬ìš©
                    const videoCount = formatNumber(stats.videoCount);
                    
                    const description = escapeHTML(snippet.description);

                    return `
                        <div class="channel-card" data-channel-id="${channelId}">
                            <img src="${bannerUrl}" alt="${title} ë°°ë„ˆ" class="channel-banner" loading="lazy">
                            <div class="channel-content">
                                <a href="${url}" target="_blank" rel="noopener noreferrer">
                                    <img src="${logoUrl}" alt="${title} ë¡œê³ " class="channel-logo" loading="lazy">
                                </a>
                                <a href="${url}" target="_blank" rel="noopener noreferrer" class="channel-title" title="${title}">${title}</a>
                                <p class="channel-description" title="${description}">${description || 'ì„¤ëª… ì—†ìŒ'}</p>
                                <div class="channel-stats">
                                    <div class="stat-item">
                                        <strong>${subCount}</strong>
                                        <span>êµ¬ë…ì</span>
                                    </div>
                                    <div class="stat-item">
                                        <strong>${viewCount}</strong>
                                        <span>ì´ ì¡°íšŒìˆ˜</span>
                                    </div>
                                    <div class="stat-item">
                                        <strong>${videoCount}</strong>
                                        <span>ì´ ì˜ìƒ ìˆ˜</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                dom.resultsContainer.appendChild(grid);
            }

            /**
             * [ì‹ ê·œ] í…Œì´ë¸” ë·° ë Œë”ë§ (ì±„ë„ìš©)
             */
            function renderTableView(results) {
                const wrapper = document.createElement('div');
                wrapper.className = 'results-table-wrapper';
                
                const tableHeader = `
                    <thead>
                        <tr>
                            <th>ì±„ë„</th>
                            <th>êµ¬ë…ì ìˆ˜</th>
                            <th>ì´ ì¡°íšŒìˆ˜</th>
                            <th>ì´ ì˜ìƒ ìˆ˜</th>
                            <th>ì„¤ëª…</th>
                            <th>ì±„ë„ ìƒì„±ì¼</th>
                        </tr>
                    </thead>
                `;
                
                const tableBody = results.map(item => {
                    const snippet = item.snippet || {};
                    const stats = item.statistics || {};

                    const channelId = item.id;
                    const title = escapeHTML(snippet.title);
                    const url = `https://www.youtube.com/channel/${channelId}`;
                    const logoUrl = snippet.thumbnails?.default?.url || 'https://placehold.co/48x48/e0e0e0/757575?text=...';
                    
                    const subCount = stats.hiddenSubscriberCount 
                        ? `<span class="stat-hidden">ë¹„ê³µê°œ</span>` 
                        : `<span class="stat-strong">${formatSubscriberCount(stats.subscriberCount)}</span>`;
                    
                    const viewCount = `<span class="stat-strong">${formatSubscriberCount(stats.viewCount)}</span>`;
                    const videoCount = `<span class="stat-strong">${formatNumber(stats.videoCount)}</span>`;
                    
                    const description = escapeHTML(snippet.description);
                    const publishedAt = formatDate(snippet.publishedAt);

                    return `
                        <tr>
                            <td>
                                <div class="table-logo-container">
                                    <img src="${logoUrl}" alt="${title} ë¡œê³ " class="table-logo" loading="lazy">
                                    <a href="${url}" target="_blank" rel="noopener noreferrer" class="table-channel-title" title="${title}">${title}</a>
                                </div>
                            </td>
                            <td>${subCount}</td>
                            <td>${viewCount}</td>
                            <td>${videoCount}</td>
                            <td class="table-description" title="${description}">${description}</td>
                            <td>${publishedAt}</td>
                        </tr>
                    `;
                }).join('');

                wrapper.innerHTML = `
                    <table class="results-table">
                        ${tableHeader}
                        <tbody>${tableBody}</tbody>
                    </table>
                `;
                dom.resultsContainer.appendChild(wrapper);
            }

            /**
             * í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸ (ë³€ê²½ ì—†ìŒ)
             */
            function updatePagination(searchData) {
                dom.prevPageBtn.disabled = pageTokens.prev.length <= 1;
                dom.nextPageBtn.disabled = !pageTokens.next;
                dom.paginationControls.classList.toggle('hidden', !searchData && currentResults.length === 0);
            }
            
            /**
             * ë·° ëª¨ë“œ ì „í™˜ (ê¸°ë³¸ê°’ ë³€ê²½)
             */
            function toggleView(forceGrid = false) {
                const isTable = currentView === 'table';
                if (forceGrid) {
                    currentView = 'grid';
                } else {
                    currentView = isTable ? 'grid' : 'table';
                }

                if (currentView === 'grid') {
                    dom.viewToggleBtn.textContent = 'ë³´ê¸°: í…Œì´ë¸”';
                    dom.viewToggleBtn.classList.remove('btn-primary');
                    dom.viewToggleBtn.classList.add('btn-success');
                } else {
                    dom.viewToggleBtn.textContent = 'ë³´ê¸°: ì¹´ë“œ';
                    dom.viewToggleBtn.classList.remove('btn-success');
                    dom.viewToggleBtn.classList.add('btn-primary');
                }
                
                renderResults(currentResults);
                saveSettings();
            }


            // --- ë‚´ë³´ë‚´ê¸° ë¡œì§ (ì±„ë„ìš© ê°œí¸) ---

            function exportCSV() {
                if (currentResults.length === 0) {
                    showToast('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                const headers = [
                    'channelId', 'title', 'description', 'subscriberCount', 'hiddenSubscribers', 
                    'viewCount', 'videoCount', 'publishedAt', 'url', 'thumbnailUrl'
                ];
                
                const csvRows = [headers.join(',')];

                currentResults.forEach(item => {
                    const snippet = item.snippet || {};
                    const stats = item.statistics || {};

                    const row = [
                        item.id,
                        snippet.title,
                        snippet.description,
                        stats.subscriberCount || 0,
                        stats.hiddenSubscriberCount || false,
                        stats.viewCount || 0,
                        stats.videoCount || 0,
                        snippet.publishedAt,
                        `https://www.youtube.com/channel/${item.id}`,
                        snippet.thumbnails?.high?.url
                    ];
                    
                    csvRows.push(row.map(escapeCSV).join(','));
                });

                const csvString = csvRows.join('\n');
                const blob = new Blob(['\uFEFF' + csvString], { type: 'text/csv;charset=utf-8;' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `youtube_channels_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                showToast('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.', 'success');
            }

            function copyJSON() {
                if (currentResults.length === 0) {
                    showToast('ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                const jsonString = JSON.stringify(currentResults, null, 2);
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = jsonString;
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast('JSONì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (e) {
                     showToast('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }


            // --- API í…ŒìŠ¤íŠ¸ (ë³€ê²½ ì—†ìŒ) ---
            
            async function testApiKey() {
                apiKey = dom.apiKeyInput.value;
                if (!apiKey) {
                    showToast('í…ŒìŠ¤íŠ¸í•  API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                    return;
                }
                const testUrl = `${YOUTUBE_API_BASE}/i18nLanguages?part=snippet&key=${apiKey}`;
                showToast('API í‚¤ í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
                try {
                    const response = await fetch(testUrl);
                    const data = await response.json();
                    if (response.ok) {
                        showToast('API í‚¤ê°€ ìœ íš¨í•©ë‹ˆë‹¤.', 'success');
                    } else {
                        handleApiError(new Error(data.error?.message), data);
                    }
                } catch (e) {
                    handleApiError(e);
                }
            }


            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë°”ì¸ë”© (ê°œí¸) ---

            // ê²€ìƒ‰ì–´ ì…ë ¥ (ë””ë°”ìš´ìŠ¤)
            const debouncedSearch = debounce(() => handleSearch(null), 300);
            dom.searchQueryInput.addEventListener('input', debouncedSearch);
            dom.searchQueryInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    clearTimeout(searchTimeout);
                    handleSearch(null);
                }
            });

            // [ì‹ ê·œ] í•„í„° ë³€ê²½ ì‹œ ìë™ ê²€ìƒ‰
            dom.regionCodeSelect.addEventListener('change', () => handleSearch(null));
            dom.subscriberCountSelect.addEventListener('change', () => handleSearch(null));
            dom.sortOrderSelect.addEventListener('change', () => handleSearch(null));
            dom.resultCountSelect.addEventListener('change', () => handleSearch(null));

            // [ì œê±°] ê¸°ê°„ ì¹© ë¦¬ìŠ¤ë„ˆ

            // API í‚¤ í† ê¸€
            dom.apiKeyToggle.addEventListener('click', () => {
                const isPassword = dom.apiKeyInput.type === 'password';
                dom.apiKeyInput.type = isPassword ? 'text' : 'password';
                dom.apiKeyToggle.textContent = isPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸';
            });
            
            // API í‚¤ ì•”í˜¸í™”
            dom.saveKeyBtn.addEventListener('click', encryptAndStoreKey);
            dom.loadKeyBtn.addEventListener('click', loadAndDecryptKey);

            // ë·° í† ê¸€
            dom.viewToggleBtn.addEventListener('click', () => toggleView());
            
            // ë¦¬ì…‹
            dom.resetBtn.addEventListener('click', resetSettings);
            
            // ë‚´ë³´ë‚´ê¸°
            dom.exportCsvBtn.addEventListener('click', exportCSV);
            dom.copyJsonBtn.addEventListener('click', copyJSON);
            
            // API í…ŒìŠ¤íŠ¸
            dom.apiTestBtn.addEventListener('click', testApiKey);

            // ê²½ê³  ë°°ë„ˆ ë‹«ê¸°
            dom.closeBannerBtn.addEventListener('click', () => {
                dom.warningBanner.style.display = 'none';
                updateBodyPadding();
            });

            // í˜ì´ì§€ë„¤ì´ì…˜
            dom.prevPageBtn.addEventListener('click', () => {
                pageTokens.prev.pop(); 
                const prevToken = pageTokens.prev.pop(); 
                handleSearch(prevToken);
            });
            dom.nextPageBtn.addEventListener('click', () => {
                handleSearch(pageTokens.next);
            });

            // [ì œê±°] "ë”ë³´ê¸°/ì ‘ê¸°" ë¦¬ìŠ¤ë„ˆ
            
            // --- ì´ˆê¸°í™” ë¡œì§ ---
            function updateBodyPadding() {
                const searchBarHeight = dom.searchBar.offsetHeight;
                const bannerHeight = dom.warningBanner.offsetHeight;
                const totalPadding = (dom.warningBanner.style.display === 'none' ? 0 : bannerHeight) + searchBarHeight;
                
                document.body.style.paddingTop = `${totalPadding + 10}px`;
                dom.warningBanner.style.top = `${searchBarHeight}px`;
            }

            // ì´ˆê¸° ë¡œë“œ
            loadSettings();
            updateBodyPadding();
            updatePagination(null); // ì´ˆê¸° í˜ì´ì§€ë„¤ì´ì…˜ ìˆ¨ê¹€

            window.addEventListener('resize', debounce(updateBodyPadding, 100));

            if (window.location.protocol === 'file:') {
                console.warn(
                    "file:// í”„ë¡œí† ì½œë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. API ìš”ì²­ì´ Referrer Policy " +
                    "ë¡œ ì¸í•´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¡œì»¬ ì›¹ ì„œë²„ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤."
                );
            }

        }); // DOMContentLoaded End
    </script>

</body>
</html>